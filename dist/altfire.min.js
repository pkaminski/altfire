(function(window, undefined){angular.module("altfire",[]).factory("fire",["$interpolate","$q","$timeout","$rootScope","orderByFilter","fireHelpers",function(s,d,h,e,p,m){function q(a){var b=w(a.ref().toString(),a.name(),a.val());a.hasChildren()&&null!==a.getPriority()&&Object.defineProperty(b,".priority",{value:a.getPriority()});return b}function w(a,b,c){var g;angular.isArray(c)?g=E(a)||{}:angular.isObject(c)&&(g=E(a)||c);g&&(Object.defineProperty(g,"$key",{value:b}),angular.forEach(c,function(b,c){null===b||angular.isUndefined(b)||
(g[c]=w(a+"/"+c,c,b))}));return g||c}function f(a,b){function c(a){return new Firebase(a.slice(0,a.indexOf("/",8)+1)+".info/serverTimeOffset")}b&&c(b).off("value",z);if(a)c(a).on("value",z)}function z(a){I=a.val()}function y(a,b){if(a in t)return t[a];Object.keys(t).length>=J&&(t={});if(angular.isString(a)){var c="https://"===a.slice(0,8);if(a&&(-1!==(c?a.slice(8):a).indexOf("//")||"/"===a.charAt(a.length-1)||"/"===a.charAt(0))){try{throw Error("Invalid path interpolation: "+a);}catch(g){if(b)throw g;
/\baltfire\b/.test(g.stack)&&console.log(g.stack.replace(/\n[^\n]*(altfire|angular(\.min)?)\.js[^\n]*$/gm,""))}return t[a]=null}if(!c){if(!x)throw Error("Relative path given and default root not specified.");a=t[a]=x+a}}return a}function F(a,b,c,g,d){function r(a){return[y(e?e(a):b,d),y(m?m(a):c,d)]}a.$watch||(d=!0);c&&-1===b.search("#")&&(b+="/#");var e=angular.isString(b)?s(b,!1):void 0,m=angular.isString(c)?s(c,!1):void 0;!d&&a.$watch&&a.$watch(r,function(a){f&&angular.equals(a,f)||(f=null,g.apply(null,
a))},!0);var f=r(a);g.apply(null,f)}function n(a,b,c,g,f,r,w){function z(){r&&(A(r),l.allowedKeys={});"viaKeys"===f||"viaValues"===f?angular.forEach(a[b],function(a,b){D([b],a)}):g&&D([],a[b]);G&&G();u&&u.destroy();delete a[b]}function k(a,b,c){var g=a.toString();B[g]||(B[g]={});B[g][b]||(B[g][b]=[]);B[g][b].push(c);a.on(b,c)}function A(a){var b=B[a.toString()];b&&angular.forEach(b,function(b,g){angular.forEach(b,function(b){a.off(g,b)})});delete B[a.toString()]}function n(){if("via"===f)k(r,"value",
function(c){g&&(D([],a[b]),delete a[b]);if(c.hasChildren())throw Error("via value of "+r+" must not be an object, ignoring: "+c.val());l.filterValue=c.val();l.ref=g=new Firebase(H.replace("#",l.filterValue));v([],s)});else if("viaKeys"===f||"viaValues"===f)a[b]=a[b]||{},k(r,"value",function(a){l.filterValue=q(a);l.filterValue?angular.forEach(l.filterValue,function(a,b){"$"!==b.charAt(0)&&y("viaKeys"===f?b:w(a),!0)}):t()}),k(r,"child_removed",function(a){y(a.name(),!1)});else if("viaIds"===f)if(a[b]=
a[b]||{},l.filterValue=r,r.length)for(var c=0;c<r.length;c++)y(r[c],!0);else t()}function p(a,b){if((l.isReady||angular.isObject(b))&&!angular.isUndefined(b)){var c=x(a);b=m.fireCopy(b);angular.isObject(b)&&!angular.isArray(b)?c.update(b):c.set(b)}}function y(c,g){if(c&&!!l.allowedKeys[c]!==g)if(g)l.allowedKeys[c]=!0,v([c],F(c));else{var f=a[b]&&a[b][c];C("child_removed",[],c);D([c],f);delete l.allowedKeys[c]}}function s(g){e.$evalAsync(function(){l.isReady?angular.isObject(g)&&angular.isObject(a[b])||
(a[b]=g,u&&(u.savedScope[b]=angular.copy(g))):(a[b]=m.fireMerge(g,a[b]),t(),"bind"===c&&l.ready().then(function(){p([],a[b])}))})}function F(c){return function(g){angular.isObject(g)&&angular.isObject(a[b]&&a[b][c])||angular.isUndefined(a[b])||(a[b][c]=g,u&&(u.savedScope[b][c]=angular.copy(g)),!l.isReady&&Object.keys(l.allowedKeys).every(function(c){return a[b].hasOwnProperty(c)})&&t(),l.isReady&&e.$evalAsync(function(){}))}}function t(){l.isReady||(l.isReady=!0,h(function(){E.resolve()}))}function x(a){var b;
H&&"via"!==f?(b=new Firebase(H.replace("#",a[0])),1<a.length&&(b=b.child(a.slice(1).join("/")))):b=a.length?(g.ref?g.ref():g).child(a.join("/")):g;return b}function v(a,b){a=a||[];var c=x(a);k(c,"child_added",function(b){var c=q(b);b.hasChildren()&&v(a.concat(b.name()));C("child_added",a,b.name(),c)});k(c,"child_removed",function(b){D(a.concat(b.name()),q(b));C("child_removed",a,b.name())});k(c,"child_changed",function(b){b.hasChildren()||C("child_changed",a,b.name(),b.val())});b&&k(c,"value",function(a){b(q(a))})}
function D(a,b){a=a||[];var c=x(a);angular.isObject(b)&&angular.forEach(b,function(b,c){angular.isString(c)&&"$"===c.charAt(0)||D(a.concat(c),b)});A(c)}function C(c,g,f,d){e.$evalAsync(function(){var A=m.parsePath(b,g);switch(c){case "child_removed":m.remove(A(a),f,d);u&&m.remove(A(u.savedScope),f);break;case "child_added":case "child_changed":m.set(A(a),f,d),u&&m.set(A(u.savedScope),f,angular.copy(d))}})}var l={},B={};w=w||angular.identity;var E=d.defer();a.$on&&a.$on("$destroy",z);l.destroy=z;l.isReady=
!1;l.ready=function(){return E.promise};if(r){l.allowedKeys={};var H=g;g=null;n();l[f+"Ref"]=r}else v([],s),l.ref=g;var u,G;"bind"===c&&(u=m.makeObjectReporter(a,b,p),G=e.$watch(u.compare,angular.noop));return l}var k={},x=null,C={},v=null,t={},J=5E3;k.setDefaultConstructorMap=function(a){C=angular.copy(a);v=null};var K=function(){v||(v=[],angular.forEach(C,function(a,b){var c=[],g=y(b,!0).replace(/\b\$[^\/]+/g,function(a){c.push(a);return"([^/]+)"});v.push({constructor:a,variables:c,regex:RegExp("^"+
g.replace(/[$-.?[-^{|}]/g,"\\$&")+"$")})}));return v},E=function(a){for(var b=K(),c=0;c<b.length;c++){var g=b[c];g.regex.lastIndex=0;var f=g.regex.exec(a);if(f){a=new g.constructor;for(b=0;b<g.variables.length;b++)Object.defineProperty(a,g.variables[b],{value:f[b+1]});return a}}};k.setDefaultRoot=function(a){angular.isString(a)||(a=a.toString());if(0!==a.search(/^https?:\/\//))throw Error("Firebase root URL must start with http(s)://, got: "+a);"/"!==a.charAt(a.length-1)&&(a+="/");f(a,x);x=a;t={};
v=null};var I=0;k.getDefaultServerTimestamp=function(){return(new Date).getTime()+I};k.ref=function(a,b){return new Firebase(y(s(b)(a)))};k.connectOne=function(a){function b(b){a.query&&(b=a.query(b));return b}if(!a.name)throw Error("Must provide a name for the connection.");if(1!==("bind"in a)+("pull"in a)+("once"in a)+("noop"in a))throw Error('Each connection must specify exactly one of "bind", "pull", "once" and "noop".');var c,g;angular.forEach(["bind","pull","once","noop"],function(b){b in a&&
(c=b,g=a[b])});var f="ref",e,m;angular.forEach(["via","viaKeys","viaValues","viaIds"],function(b){if(b in a){if(e)throw Error('A connection can specify at most one of "via", "viaKeys", "viaValues", and "viaIds".');e=b;"viaIds"===b?f=null:(m=a[b],f=b+"Ref")}});if(e&&("once"===c||"noop"===c))throw Error('Cannot combine via* with "once" or "noop".');if(a.viaValueExtractor&&"viaValues"!==e)throw Error('Can only use "viaValueExtractor" with "viaValues".');if("viaIds"===e&&a.query)throw Error("Cannot combine viaIds with a query.");
var k;F(a.pathScope||a.scope,g,m,function(g,h){k&&(k.destroy(),k=null);if("noop"===c&&g)k={destroy:angular.noop,isReady:!0,ready:function(){return d.when()}},k[f]=b(new Firebase(g));else if("once"===c&&g){var w=d.defer(),z=k={destroy:angular.noop,isReady:!1,ready:function(){return w.promise}};k[f]=b(new Firebase(g));k[f].once("value",function(b){k===z&&(a.scope[a.name]=q(b),k.isReady=!0,w.resolve())})}else!g||m&&!h||(k=h?n(a.scope,a.name,c,g,e,b(new Firebase(h)),a.viaValueExtractor):"viaIds"===e?
n(a.scope,a.name,c,g,e,a.viaIds):n(a.scope,a.name,c,b(new Firebase(g))))});var h={destroy:function(){k&&k.destroy()},isReady:function(){return k&&k.isReady},ready:function(){return k&&k.ready()},allowedKeys:function(){return k&&k.allowedKeys}};f&&(h[f]=function(){var a=k[f];a.ref&&(a=a.ref());arguments.length&&(a=a.child(Array.prototype.slice.call(arguments,0).join("/")));return a});"via"===e&&(h.ref=function(){var a=k.ref;a.ref&&(a=a.ref());arguments.length&&(a=a.child(Array.prototype.slice.call(arguments,
0).join("/")));return a});e&&(h[e]=function(){return k.filterValue});return h};k.connect=function(a,b){var c={};angular.forEach(b,function(b,f){b.scope=a;b.name=f;c[f]=k.connectOne(b)});c.$allReady=function(){var b=[],f=[];angular.forEach(c,function(a,c){"$"!==c.charAt(0)&&(b.push(c),a.ready()&&f.push(a.ready()))});return d.all(f).then(function(){var c={};angular.forEach(b,function(b){c[b]=a[b]});return c})};c.$areAllReady=function(){var a=!0;angular.forEach(c,function(b,c){"$"!==c.charAt(0)&&(a=
a&&b.isReady())});return a};c.$destroyAll=function(){angular.forEach(c,function(a,b){"$"!==b.charAt(0)&&a.destroy()})};return c};k.toArrayOrderedByKey=function(a){var b=[];a&&(angular.forEach(a,function(a,f){angular.isObject(a)&&b.push(a)}),p(b,"$key"));return b};k.generateUniqueKey=function(){return(new Firebase(x)).push().name()};return k}]).factory("fireHelpers",[function(){var s={remove:function(d,h){angular.isArray(d)?d.splice(h,1):d&&delete d[h]},set:function(d,h,e){d&&(d[h]=e)},parsePath:function(d,
h){return function(e){e=e[d];for(var p=0,m=h.length;p<m;p++){if(null===e||angular.isUndefined(e))return;e=e[h[p]]}return e}},fireCopy:function(d){if(angular.isObject(d)){var h=angular.isArray(d)?Array(d.length):{},e;for(e in d)d.hasOwnProperty(e)&&("$"!==e.charAt(0)&&angular.isDefined(d[e]))&&(angular.isObject(d[e])?h[e]=s.fireCopy(d[e]):h[e]=d[e]);return h}return d},fireMerge:function(d,h){if(angular.equals(d,h))return h;if(angular.isArray(d)&&angular.isArray(h))return h.concat(d);if(angular.isObject(d)&&
angular.isObject(h)){for(var e in d)h[e]=d[e];return h}return(angular.isUndefined(d)||null===d)&&angular.isDefined(h)?h:d},makeObjectReporter:function(d,h,e){function p(d,f){angular.isUndefined(f)&&(f=null);d.shift();e(d,f)}function m(d,f,e,h,q){if(!e.charAt||"$"!==e.charAt(0)){q--;if(!q&&!angular.equals(d[e],f[e]))return d[e]=angular.copy(f[e]),p(h.concat(e),f[e]);f=f[e];var n=d[e],k;if(angular.isObject(f))if(angular.isArray(f)){angular.isArray(n)||(p(h.concat(e),f),d[e]=n=f.slice());if(n.length>
f.length)for(d=f.length,k=n.length;d<k;d++)p(h.concat(e,d),null);n.length=f.length;d=0;for(k=f.length;d<k;d++)m(n,f,d,h.concat(e),q)}else{if(!angular.isObject(n)||angular.isArray(n))p(h.concat(e),f),d[e]=n=angular.copy(f);for(k in f)f.hasOwnProperty(k)&&m(n,f,k,h.concat(e),q);for(k in n)f.hasOwnProperty(k)||(delete n[k],p(h.concat(e,k),null))}else f!==n&&(d[e]=f,p(h.concat(e),f))}}var q={};q[h]=angular.copy(d[h]);return{savedScope:q,compare:function(){m(q,d,h,[],6)},destroy:function(){q&&delete q[h];
q=null}}}};return s}]);
(function(){function s(d,h){angular.forEach(h,function(h,f){var q=d[f];d[f]=function(){var d=arguments[h]||angular.noop,m=Array.prototype.slice.call(arguments),n=this;m[h]=function(k){var h=d.apply(this,arguments);k&&h!==Firebase.IGNORE_ERROR&&angular.forEach(e,function(d){d(k,n,f)})};return q.apply(this,m)}});return d}function d(e){s(e,{on:2,once:2});angular.forEach(["limit","startAt","endAt"],function(h){var p=e[h];e[h]=function(){return d(p.apply(this,arguments))}});return e}function h(){if(!p){s(Firebase.prototype,
{auth:1,set:1,update:1,setWithPriority:2,setPriority:1,transaction:1});var e=Firebase.prototype.onDisconnect;Firebase.prototype.onDisconnect=function(){return s(e.apply(this,arguments),{set:1,setWithPriority:2,update:1,remove:0,cancel:0})};d(Firebase.prototype);p=!0}}Firebase.IGNORE_ERROR={};var e=[],p=!1;Firebase.onError=function(d){h();e.push(d);return d};Firebase.offError=function(d){d=e.indexOf(d);-1!==d&&e.splice(d,1)}})();}).call(window);
