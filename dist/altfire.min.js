(function(window, undefined){angular.module("altfire",[]).factory("fire",["$interpolate","$q","$timeout","$rootScope","orderByFilter","fireHelpers",function(t,d,h,e,p,l){function q(a){var b=s(a.ref().toString(),a.name(),a.val());a.hasChildren()&&null!==a.getPriority()&&Object.defineProperty(b,".priority",{value:a.getPriority()});return b}function s(a,b,c){var f;angular.isArray(c)?f=G(a)||{}:angular.isObject(c)&&(f=G(a)||c);f&&(Object.defineProperty(f,"$key",{value:b}),Object.defineProperty(f,"$ref",{value:new Firebase(a)}),angular.forEach(c,
function(b,c){null===b||angular.isUndefined(b)||(f[c]=s(a+"/"+c,c,b))}));return f||c}function g(a,b){function c(a){return new Firebase(a.slice(0,a.indexOf("/",8)+1)+".info/serverTimeOffset")}b&&c(b).off("value",B);if(a)c(a).on("value",B)}function B(a){H=a.val()}function C(a,b){if(a in v)return v[a];Object.keys(v).length>=K&&(v={});if(angular.isString(a)){var c="https://"===a.slice(0,8);if(a&&(-1!==(c?a.slice(8):a).indexOf("//")||"/"===a.charAt(a.length-1)||"/"===a.charAt(0))){try{throw Error("Invalid path interpolation: "+
a);}catch(f){if(b)throw f;/\baltfire\b/.test(f.stack)&&console.log(f.stack.replace(/\n[^\n]*(altfire|angular(\.min)?)\.js[^\n]*$/gm,""))}return v[a]=null}if(!c){if(!y)throw Error("Relative path given and default root not specified.");a=v[a]=y+a}}return a}function D(a,b,c,f,k){function w(a){return[C(d?d(a):b,k),C(e?e(a):c,k)]}a.$watch||(k=!0);c&&-1===b.search("#")&&(b+="/#");var d=angular.isString(b)?t(b,!1):void 0,e=angular.isString(c)?t(c,!1):void 0;!k&&a.$watch&&a.$watch(w,function(a){l&&angular.equals(a,
l)||(l=null,f.apply(null,a))},!0);var l=w(a);f.apply(null,l)}function m(a,b,c){this.onChange=a.onChange;this.onCollectionChange=a.onCollectionChange;this.change=!1;this.addedKeys=[];this.removedKeys=[];this.movedKeys=[];this.allKeys=[];this.fireChangesAsync=angular.bind(e,e.$evalAsync,angular.bind(this,this.fireChanges));this.eventMethods={};a.onChange&&(this.eventMethods.value=angular.bind(this,this.valueChanged));a.onCollectionChange&&angular.extend(this.eventMethods,{child_added:angular.bind(this,
this.childAdded),child_removed:angular.bind(this,this.childRemoved),child_moved:angular.bind(this,this.childMoved)});var f=a.child?t(a.child,!1):null;e.$watch(function(){var k=b.ref();if(!k)return null;k=k.toString();if(a.child){var d=a.child;if(f&&(d=f(c),-1!==d.indexOf("//")||"/"===d.charAt(d.length-1)||"/"===d.charAt(0)))return null;k=k+"/"+d}return k},angular.bind(this,function(a){this.ref&&this.unlisten();this.ref=a?new Firebase(a):null;this.change=!0;this.addedKeys=[];this.movedKeys=[];this.removedKeys=
this.allKeys;this.allKeys=[];this.ref?this.listen():this.fireChangesAsync()}))}function r(a,b,c,f,k,w,g){function I(){angular.forEach(A,function(a,b){B(new Firebase(b))});"viaKeys"===k||"viaValues"===k?angular.forEach(a[b],function(a,b){v([b],a)}):f&&v([],a[b]);E&&E();x&&x.destroy();delete a[b]}function s(a,b,f){var c=a.toString();A[c]||(A[c]={});A[c][b]||(A[c][b]=[]);A[c][b].push(f);a.on(b,f)}function B(a){var b=A[a.toString()];b&&angular.forEach(b,function(b,c){angular.forEach(b,function(b){a.off(c,
b)})});delete A[a.toString()]}function L(){if("via"===k)s(w,"value",function(c){f&&(v([],a[b]),delete a[b]);if(c.hasChildren())throw Error("via value of "+w+" must not be an object, ignoring: "+c.val());n.filterValue=c.val();n.ref=f=new Firebase(F.replace("#",n.filterValue));D([],p)});else if("viaKeys"===k||"viaValues"===k)a[b]=a[b]||{},s(w,"value",function(a){n.filterValue=q(a);n.filterValue?angular.forEach(n.filterValue,function(a,b){"$"!==b.charAt(0)&&r("viaKeys"===k?b:g(a),!0)}):u()}),s(w,"child_removed",
function(a){r(a.name(),!1)});else if("viaIds"===k)if(a[b]=a[b]||{},n.filterValue=w,w.length)for(var c=0;c<w.length;c++)r(w[c],!0);else u()}function m(a,b){if((n.isReady||angular.isObject(b))&&!angular.isUndefined(b)){var c=t(a);b=l.fireCopy(b);angular.isObject(b)&&!angular.isArray(b)?c.update(b):c.set(b)}}function r(c,f){if(c&&!!n.allowedKeys[c]!==f)if(f)n.allowedKeys[c]=!0,D([c],C(c));else{var d=a[b]&&a[b][c];y("child_removed",[],c);v([c],d);delete n.allowedKeys[c]}}function p(f){n.isReady?angular.isObject(f)&&
angular.isObject(a[b])||(a[b]=f,x&&(x.savedScope[b]=angular.copy(f))):(a[b]=l.fireMerge(f,a[b]),u(),"bind"===c&&n.ready().then(function(){m([],a[b])}));e.$evalAsync(angular.noop)}function C(c){return function(f){angular.isObject(f)&&angular.isObject(a[b]&&a[b][c])||angular.isUndefined(a[b])||(a[b][c]=f,x&&(x.savedScope[b][c]=angular.copy(f)),!n.isReady&&Object.keys(n.allowedKeys).every(function(c){return a[b].hasOwnProperty(c)})&&u(),n.isReady&&e.$evalAsync(angular.noop))}}function u(){n.isReady||
(n.isReady=!0,h(function(){z.resolve()}))}function t(a){var b;F&&"via"!==k?(b=new Firebase(F.replace("#",a[0])),1<a.length&&(b=b.child(a.slice(1).join("/")))):b=a.length?(f.ref?f.ref():f).child(a.join("/")):f;return b}function D(a,b){a=a||[];var c=t(a);s(c,"child_added",function(b){var c=q(b);b.hasChildren()&&D(a.concat(b.name()));y("child_added",a,b.name(),c)});s(c,"child_removed",function(b){v(a.concat(b.name()),q(b));y("child_removed",a,b.name())});s(c,"child_changed",function(b){b.hasChildren()||
y("child_changed",a,b.name(),b.val())});b&&s(c,"value",function(a){b(q(a))})}function v(a,b){a=a||[];var c=t(a);angular.isObject(b)&&angular.forEach(b,function(b,c){angular.isString(c)&&"$"===c.charAt(0)||v(a.concat(c),b)});B(c)}function y(c,f,d,k){f=l.parsePath(b,f);switch(c){case "child_removed":l.remove(f(a),d,k);x&&l.remove(f(x.savedScope),d);break;case "child_added":case "child_changed":l.set(f(a),d,k),x&&l.set(f(x.savedScope),d,angular.copy(k))}e.$evalAsync(angular.noop)}var n={},A={};g=g||
angular.identity;var z=d.defer();a.$on&&a.$on("$destroy",I);n.destroy=I;n.isReady=!1;n.ready=function(){return z.promise};if(w){n.allowedKeys={};var F=f;f=null;L();n[k+"Ref"]=w}else D([],p),n.ref=f;var x,E;"bind"===c&&(x=l.makeObjectReporter(a,b,m),E=e.$watch(x.compare,angular.noop));return n}var u={},y=null,J={},z=null,v={},K=5E3;u.setDefaultConstructorMap=function(a){J=angular.copy(a);z=null};var M=function(){z||(z=[],angular.forEach(J,function(a,b){var c=[],f=C(b,!0).replace(/\b\$[^\/]+/g,function(a){c.push(a);
return"([^/]+)"});z.push({constructor:a,variables:c,regex:RegExp("^"+f.replace(/[$-.?[-^{|}]/g,"\\$&")+"$")})}));return z},G=function(a){for(var b=M(),c=0;c<b.length;c++){var f=b[c];f.regex.lastIndex=0;var d=f.regex.exec(a);if(d){a=new f.constructor;for(b=0;b<f.variables.length;b++)Object.defineProperty(a,f.variables[b],{value:d[b+1]});return a}}};u.setDefaultRoot=function(a){angular.isString(a)||(a=a.toString());if(0!==a.search(/^https?:\/\//))throw Error("Firebase root URL must start with http(s)://, got: "+
a);"/"!==a.charAt(a.length-1)&&(a+="/");g(a,y);y=a;v={};z=null};var H=0;u.getDefaultServerTimestamp=function(){return(new Date).getTime()+H};u.ref=function(a,b){return new Firebase(C(t(b)(a)))};u.connectOne=function(a){function b(b){a.query&&(b=a.query(b));return b}if(!a.name)throw Error("Must provide a name for the connection.");if(1!==("bind"in a)+("pull"in a)+("once"in a)+("noop"in a))throw Error('Each connection must specify exactly one of "bind", "pull", "once" and "noop".');var c,f;angular.forEach(["bind",
"pull","once","noop"],function(b){b in a&&(c=b,f=a[b])});var k="ref",e,l;angular.forEach(["via","viaKeys","viaValues","viaIds"],function(b){if(b in a){if(e)throw Error('A connection can specify at most one of "via", "viaKeys", "viaValues", and "viaIds".');e=b;"viaIds"===b?k=null:(l=a[b],k=b+"Ref")}});if(e&&("once"===c||"noop"===c))throw Error('Cannot combine "'+e+'" with "once" or "noop".');if(a.watch&&e&&"via"!==e)throw Error('Cannot yet combine "'+e+'" with "watch".');if(a.viaValueExtractor&&"viaValues"!==
e)throw Error('Can only use "viaValueExtractor" with "viaValues".');if("viaIds"===e&&a.query)throw Error('Cannot combine "viaIds" with "query".');var g;D(a.pathScope||a.scope,f,l,function(f,h){g&&(g.destroy(),g=null);if("noop"===c&&f)g={destroy:angular.noop,isReady:!0,ready:function(){return d.when()}},g[k]=b(new Firebase(f));else if("once"===c&&f){var s=d.defer(),B=g={destroy:angular.noop,isReady:!1,ready:function(){return s.promise}};g[k]=b(new Firebase(f));g[k].once("value",function(b){g===B&&
(a.scope[a.name]=q(b),g.isReady=!0,s.resolve())})}else!f||l&&!h||(g=h?r(a.scope,a.name,c,f,e,b(new Firebase(h)),a.viaValueExtractor):"viaIds"===e?r(a.scope,a.name,c,f,e,a.viaIds):r(a.scope,a.name,c,b(new Firebase(f))))});var s=[],h={destroy:function(){g&&g.destroy();angular.forEach(s,function(a){a.destroy()})},isReady:function(){return g&&g.isReady},ready:function(){return g&&g.ready()},allowedKeys:function(){return g&&g.allowedKeys}};k&&(h[k]=function(){var a=g&&g[k];a&&(a.ref&&(a=a.ref()),arguments.length&&
(a=a.child(Array.prototype.slice.call(arguments,0).join("/"))));return a});"via"===e&&(h.ref=function(){var a=g&&g.ref;a&&(a.ref&&(a=a.ref()),arguments.length&&(a=a.child(Array.prototype.slice.call(arguments,0).join("/"))));return a});e&&(h[e]=function(){return g&&g.filterValue});angular.forEach(a.watch,function(b){s.push(new m(b,h,a.pathScope||a.scope))});return h};u.connect=function(a,b){var c={};angular.forEach(b,function(b,g){b.scope=a;b.name=g;c[g]=u.connectOne(b)});c.$allReady=function(){var b=
[],g=[];angular.forEach(c,function(a,c){"$"!==c.charAt(0)&&(b.push(c),a.ready()&&g.push(a.ready()))});return d.all(g).then(function(){var c={};angular.forEach(b,function(b){c[b]=a[b]});return c})};c.$areAllReady=function(){var a=!0;angular.forEach(c,function(b,c){"$"!==c.charAt(0)&&(a=a&&b.isReady())});return a};c.$destroyAll=function(){angular.forEach(c,function(a,b){"$"!==b.charAt(0)&&a.destroy()})};return c};u.toArrayOrderedByKey=function(a){var b=[];a&&(angular.forEach(a,function(a,f){angular.isObject(a)&&
b.push(a)}),p(b,"$key"));return b};u.generateUniqueKey=function(){return(new Firebase(y)).push().name()};m.prototype.listen=function(){angular.forEach(this.eventMethods,function(a,b){this.ref.on(b,a)},this)};m.prototype.unlisten=function(){angular.forEach(this.eventMethods,function(a,b){this.ref.off(b,a)},this)};m.prototype.destroy=function(){this.ref&&this.unlisten()};m.prototype.valueChanged=function(){this.change=!0;this.fireChangesAsync()};m.prototype.childAdded=function(a){this.addedKeys.push(a.name());
a=this.removedKeys.indexOf(a.name());0<=a&&this.removedKeys.splice(a,1);this.fireChangesAsync()};m.prototype.childRemoved=function(a){this.removedKeys.push(a.name());var b=this.addedKeys.indexOf(a.name());0<=b&&this.addedKeys.splice(b,1);b=this.movedKeys.indexOf(a.name());0<=b&&this.movedKeys.splice(b,1);b=this.allKeys.indexOf(a.name());0<=b&&this.allKeys.splice(b,1);this.fireChangesAsync()};m.prototype.childMoved=function(a){this.movedKeys.push(a.name());this.fireChangesAsync()};m.prototype.fireChanges=
function(){this.onChange&&this.change&&(this.change=!1,this.onChange());if(this.onCollectionChange&&(this.addedKeys.length||this.removedKeys.length||this.movedKeys.length)){var a=this.addedKeys,b=this.removedKeys,c=this.movedKeys;this.allKeys.push.apply(this.allKeys,a);angular.forEach(b,function(a){a=this.allKeys.indexOf(a);0<=a&&this.allKeys.splice(a,1)},this);this.addedKeys=[];this.removedKeys=[];this.movedKeys=[];this.onCollectionChange(a,b,c)}};return u}]).factory("fireHelpers",[function(){var t=
{remove:function(d,h){angular.isArray(d)?d.splice(h,1):d&&delete d[h]},set:function(d,h,e){d&&(d[h]=e)},parsePath:function(d,h){return function(e){e=e[d];for(var p=0,l=h.length;p<l;p++){if(null===e||angular.isUndefined(e))return;e=e[h[p]]}return e}},fireCopy:function(d){if(angular.isObject(d)){var h=angular.isArray(d)?Array(d.length):{},e;for(e in d)d.hasOwnProperty(e)&&("$"!==e.charAt(0)&&angular.isDefined(d[e]))&&(angular.isObject(d[e])?h[e]=t.fireCopy(d[e]):h[e]=d[e]);return h}return d},fireMerge:function(d,
h){if(angular.equals(d,h))return h;if(angular.isArray(d)&&angular.isArray(h))return h.concat(d);if(angular.isObject(d)&&angular.isObject(h)){for(var e in d)h[e]=d[e];return h}return(angular.isUndefined(d)||null===d)&&angular.isDefined(h)?h:d},makeObjectReporter:function(d,h,e){function p(d,g){angular.isUndefined(g)&&(g=null);d.shift();e(d,g)}function l(d,g,e,h,q){if(!e.charAt||"$"!==e.charAt(0)){q--;if(!q&&!angular.equals(d[e],g[e]))return d[e]=angular.copy(g[e]),p(h.concat(e),g[e]);g=g[e];var m=
d[e],r;if(angular.isObject(g))if(angular.isArray(g)){angular.isArray(m)||(p(h.concat(e),g),d[e]=m=g.slice());if(m.length>g.length)for(d=g.length,r=m.length;d<r;d++)p(h.concat(e,d),null);m.length=g.length;d=0;for(r=g.length;d<r;d++)l(m,g,d,h.concat(e),q)}else{if(!angular.isObject(m)||angular.isArray(m))p(h.concat(e),g),d[e]=m=angular.copy(g);for(r in g)g.hasOwnProperty(r)&&l(m,g,r,h.concat(e),q);for(r in m)g.hasOwnProperty(r)||(delete m[r],p(h.concat(e,r),null))}else g!==m&&(d[e]=g,p(h.concat(e),g))}}
var q={};q[h]=angular.copy(d[h]);return{savedScope:q,compare:function(){l(q,d,h,[],6)},destroy:function(){q&&delete q[h];q=null}}}};return t}]);
(function(){function t(d,h){angular.forEach(h,function(h,g){var q=d[g];d[g]=function(){var d=arguments[h]||angular.noop,l=Array.prototype.slice.call(arguments),m=this;l[h]=function(h){var l=d.apply(this,arguments);h&&l!==Firebase.IGNORE_ERROR&&angular.forEach(e,function(d){d(h,m,g)})};return q.apply(this,l)}});return d}function d(e){t(e,{on:2,once:2});angular.forEach(["limit","startAt","endAt"],function(h){var p=e[h];e[h]=function(){return d(p.apply(this,arguments))}});return e}function h(){if(!p){t(Firebase.prototype,
{auth:1,set:1,update:1,setWithPriority:2,setPriority:1,transaction:1});var e=Firebase.prototype.onDisconnect;Firebase.prototype.onDisconnect=function(){return t(e.apply(this,arguments),{set:1,setWithPriority:2,update:1,remove:0,cancel:0})};d(Firebase.prototype);p=!0}}Firebase.IGNORE_ERROR={};var e=[],p=!1;Firebase.onError=function(d){h();e.push(d);return d};Firebase.offError=function(d){d=e.indexOf(d);-1!==d&&e.splice(d,1)}})();}).call(window);
