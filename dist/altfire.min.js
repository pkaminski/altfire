(function(window, undefined){angular.module("altfire",[]).factory("fire",["$interpolate","$q","$timeout","$rootScope","orderByFilter","fireHelpers",function(t,b,d,f,p,g){function q(a){var c=r(a.ref().toString(),a.val());a.hasChildren()&&(Object.defineProperty(c,"$key",{value:a.name()}),null!==a.getPriority()&&Object.defineProperty(c,".priority",{value:a.getPriority()}));return c}function r(a,c){var m;angular.isObject(c)?m=E(a)||c:angular.isArray(c)&&(m=E(a)||{});m&&angular.forEach(c,function(c,b){null===c||angular.isUndefined(c)||
(m[b]=r(a+"/"+b,c))});return m||c}function e(a,c){function m(a){return new Firebase(a.slice(0,a.indexOf("/",8)+1)+".info/serverTimeOffset")}c&&m(c).off("value",y);if(a)m(a).on("value",y)}function y(a){J=a.val()}function x(a,c){if(a in u)return u[a];Object.keys(u).length>=K&&(u={});if(angular.isString(a)){var m="https://"===a.slice(0,8);if(a&&(-1!==(m?a.slice(8):a).indexOf("//")||"/"===a.charAt(a.length-1)||"/"===a.charAt(0))){try{throw Error("Invalid path interpolation: "+a);}catch(b){if(c)throw b;
/\baltfire\b/.test(b.stack)&&console.log(b.stack.replace(/\n[^\n]*(altfire|angular(\.min)?)\.js[^\n]*$/gm,""))}return u[a]=null}if(!m){if(!z)throw Error("Relative path given and default root not specified.");a=u[a]=z+a}}return a}function F(a,c,b,I,k){function s(a){return[x(f?f(a):c,k),x(g?g(a):b,k)]}a.$watch||(k=!0);b&&-1===c.search("#")&&(c+="/#");var f=angular.isString(c)?t(c,!1):void 0,g=angular.isString(b)?t(b,!1):void 0;!k&&a.$watch&&a.$watch(s,function(a){e&&angular.equals(a,e)||(e=null,I.apply(null,
a))},!0);var e=s(a);I.apply(null,e)}function n(a,c,m,e,k,s,r){function y(){s&&(C(s),l.allowedKeys={});"viaKeys"===k||"viaValues"===k?angular.forEach(a[c],function(a,c){D([c],a)}):e&&D([],a[c]);G&&G();v&&v.destroy();delete a[c]}function h(a,c,b){var e=a.toString();A[e]||(A[e]={});A[e][c]||(A[e][c]=[]);A[e][c].push(b);a.on(c,b)}function C(a){var c=A[a.toString()];c&&angular.forEach(c,function(c,b){angular.forEach(c,function(c){a.off(b,c)})});delete A[a.toString()]}function n(){if("via"===k)h(s,"value",
function(b){e&&(D([],a[c]),delete a[c]);if(b.hasChildren())throw Error("via value of "+s+" must not be an object, ignoring: "+b.val());l.filterValue=b.val();l.ref=e=new Firebase(H.replace("#",l.filterValue));w([],t)});else if("viaKeys"===k||"viaValues"===k)a[c]=a[c]||{},h(s,"value",function(a){l.filterValue=q(a);l.filterValue?angular.forEach(l.filterValue,function(a,c){"$"!==c.charAt(0)&&x("viaKeys"===k?c:r(a),!0)}):u()}),h(s,"child_removed",function(a){x(a.name(),!1)});else if("viaIds"===k)if(a[c]=
a[c]||{},l.filterValue=s,s.length)for(var b=0;b<s.length;b++)x(s[b],!0);else u()}function p(a,c){if((l.isReady||angular.isObject(c))&&!angular.isUndefined(c)){var b=z(a);c=g.fireCopy(c);angular.isObject(c)&&!angular.isArray(c)?b.update(c):b.set(c)}}function x(b,e){if(b&&!!l.allowedKeys[b]!==e)if(e)l.allowedKeys[b]=!0,w([b],F(b));else{var m=a[c]&&a[c][b];B("child_removed",[],b);D([b],m);delete l.allowedKeys[b]}}function t(b){f.$evalAsync(function(){l.isReady?angular.isObject(b)&&angular.isObject(a[c])||
(a[c]=b,v&&(v.savedScope[c]=angular.copy(b))):(a[c]=g.fireMerge(b,a[c]),u(),"bind"===m&&l.ready().then(function(){p([],a[c])}))})}function F(b){return function(e){angular.isObject(e)&&angular.isObject(a[c]&&a[c][b])||angular.isUndefined(a[c])||(a[c][b]=e,v&&(v.savedScope[c][b]=angular.copy(e)),!l.isReady&&Object.keys(l.allowedKeys).every(function(b){return a[c].hasOwnProperty(b)})&&u(),l.isReady&&f.$evalAsync(function(){}))}}function u(){l.isReady||(l.isReady=!0,d(function(){E.resolve()}))}function z(a){var c;
H&&"via"!==k?(c=new Firebase(H.replace("#",a[0])),1<a.length&&(c=c.child(a.slice(1).join("/")))):c=a.length?(e.ref?e.ref():e).child(a.join("/")):e;return c}function w(a,c){a=a||[];var b=z(a);h(b,"child_added",function(c){var b=q(c);c.hasChildren()&&w(a.concat(c.name()));B("child_added",a,c.name(),b)});h(b,"child_removed",function(c){D(a.concat(c.name()),q(c));B("child_removed",a,c.name())});h(b,"child_changed",function(c){c.hasChildren()||B("child_changed",a,c.name(),c.val())});c&&h(b,"value",function(a){c(q(a))})}
function D(a,c){a=a||[];var b=z(a);angular.isObject(c)&&angular.forEach(c,function(c,b){angular.isString(b)&&"$"===b.charAt(0)||D(a.concat(b),c)});C(b)}function B(b,e,m,C){f.$evalAsync(function(){var k=g.parsePath(c,e);switch(b){case "child_removed":g.remove(k(a),m,C);v&&g.remove(k(v.savedScope),m);break;case "child_added":case "child_changed":g.set(k(a),m,C),v&&g.set(k(v.savedScope),m,angular.copy(C))}})}var l={},A={};r=r||angular.identity;var E=b.defer();a.$on&&a.$on("$destroy",y);l.destroy=y;l.isReady=
!1;l.ready=function(){return E.promise};if(s){l.allowedKeys={};var H=e;e=null;n();l[k+"Ref"]=s}else w([],t),l.ref=e;var v,G;"bind"===m&&(v=g.makeObjectReporter(a,c,p),G=f.$watch(v.compare,angular.noop));return l}var h={},z=null,B={},w=null,u={},K=5E3;h.setDefaultConstructorMap=function(a){B=angular.copy(a);w=null};var L=function(){w||(w=[],angular.forEach(B,function(a,c){var b=[],e=x(c,!0).replace(/\b\$[^\/]+/g,function(a){b.push(a);return"([^/]+)"});w.push({constructor:a,variables:b,regex:RegExp("^"+
e.replace(/[$-.?[-^{|}]/g,"\\$&")+"$")})}));return w},E=function(a){for(var c=L(),b=0;b<c.length;b++){var e=c[b];e.regex.lastIndex=0;var k=e.regex.exec(a);if(k){a=new e.constructor;for(c=0;c<e.variables.length;c++)Object.defineProperty(a,e.variables[c],{value:k[c+1]});return a}}};h.setDefaultRoot=function(a){angular.isString(a)||(a=a.toString());if(0!==a.search(/^https?:\/\//))throw Error("Firebase root URL must start with http(s)://, got: "+a);"/"!==a.charAt(a.length-1)&&(a+="/");e(a,z);z=a;u={};
w=null};var J=0;h.getDefaultServerTimestamp=function(){return(new Date).getTime()+J};h.ref=function(a,c){return new Firebase(x(t(c)(a)))};h.connectOne=function(a){function c(c){a.query&&(c=a.query(c));return c}if(!a.name)throw Error("Must provide a name for the connection.");if(1!==("bind"in a)+("pull"in a)+("once"in a)+("noop"in a))throw Error('Each connection must specify exactly one of "bind", "pull", "once" and "noop".');var e,f;angular.forEach(["bind","pull","once","noop"],function(c){c in a&&
(e=c,f=a[c])});var k="ref",g,h;angular.forEach(["via","viaKeys","viaValues","viaIds"],function(c){if(c in a){if(g)throw Error('A connection can specify at most one of "via", "viaKeys", "viaValues", and "viaIds".');g=c;"viaIds"===c?k=null:(h=a[c],k=c+"Ref")}});if(g&&("once"===e||"noop"===e))throw Error('Cannot combine via* with "once" or "noop".');if(a.viaValueExtractor&&"viaValues"!==g)throw Error('Can only use "viaValueExtractor" with "viaValues".');if("viaIds"===g&&a.query)throw Error("Cannot combine viaIds with a query.");
var d;F(a.pathScope||a.scope,f,h,function(f,r){d&&(d.destroy(),d=null);if("noop"===e&&f)d={destroy:angular.noop,isReady:!0,ready:function(){return b.when()}},d[k]=c(new Firebase(f));else if("once"===e&&f){var y=b.defer(),x=d={destroy:angular.noop,isReady:!1,ready:function(){return y.promise}};d[k]=c(new Firebase(f));d[k].once("value",function(c){d===x&&(a.scope[a.name]=q(c),d.isReady=!0,y.resolve())})}else!f||h&&!r||(d=r?n(a.scope,a.name,e,f,g,c(new Firebase(r)),a.viaValueExtractor):"viaIds"===g?
n(a.scope,a.name,e,f,g,a.viaIds):n(a.scope,a.name,e,c(new Firebase(f))))});var r={destroy:function(){d&&d.destroy()},isReady:function(){return d&&d.isReady},ready:function(){return d&&d.ready()},allowedKeys:function(){return d&&d.allowedKeys}};k&&(r[k]=function(){var a=d[k];a.ref&&(a=a.ref());arguments.length&&(a=a.child(Array.prototype.slice.call(arguments,0).join("/")));return a});"via"===g&&(r.ref=function(){var a=d.ref;a.ref&&(a=a.ref());arguments.length&&(a=a.child(Array.prototype.slice.call(arguments,
0).join("/")));return a});g&&(r[g]=function(){return d.filterValue});return r};h.connect=function(a,c){var e={};angular.forEach(c,function(c,b){c.scope=a;c.name=b;e[b]=h.connectOne(c)});e.$allReady=function(){var c=[],d=[];angular.forEach(e,function(a,b){"$"!==b.charAt(0)&&(c.push(b),a.ready()&&d.push(a.ready()))});return b.all(d).then(function(){var b={};angular.forEach(c,function(c){b[c]=a[c]});return b})};e.$areAllReady=function(){var a=!0;angular.forEach(e,function(c,b){"$"!==b.charAt(0)&&(a=
a&&c.isReady())});return a};e.$destroyAll=function(){angular.forEach(e,function(a,c){"$"!==c.charAt(0)&&a.destroy()})};return e};h.toArrayOrderedByKey=function(a){var c=[];a&&(angular.forEach(a,function(a,b){angular.isObject(a)&&c.push(a)}),p(c,"$key"));return c};return h}]).factory("fireHelpers",[function(){var t={remove:function(b,d){angular.isArray(b)?b.splice(d,1):b&&delete b[d]},set:function(b,d,f){b&&(b[d]=f)},parsePath:function(b,d){return function(f){f=f[b];for(var p=0,g=d.length;p<g;p++){if(angular.isUndefined(f))return;
f=f[d[p]]}return f}},fireCopy:function(b){if(angular.isObject(b)){var d=angular.isArray(b)?Array(b.length):{},f;for(f in b)b.hasOwnProperty(f)&&("$"!==f.charAt(0)&&angular.isDefined(b[f]))&&(angular.isObject(b[f])?d[f]=t.fireCopy(b[f]):d[f]=b[f]);return d}return b},fireMerge:function(b,d){if(angular.equals(b,d))return d;if(angular.isArray(b)&&angular.isArray(d))return d.concat(b);if(angular.isObject(b)&&angular.isObject(d)){for(var f in b)d[f]=b[f];return d}return(angular.isUndefined(b)||null===b)&&
angular.isDefined(d)?d:b},makeObjectReporter:function(b,d,f){function p(b,e){angular.isUndefined(e)&&(e=null);b.shift();f(b,e)}function g(b,e,d,f,q){if(!d.charAt||"$"!==d.charAt(0)){q--;if(!q&&!angular.equals(b[d],e[d]))return b[d]=angular.copy(e[d]),p(f.concat(d),e[d]);e=e[d];var n=b[d],h;if(angular.isObject(e))if(angular.isArray(e)){angular.isArray(n)||(p(f.concat(d),e),b[d]=n=e.slice());if(n.length>e.length)for(b=e.length,h=n.length;b<h;b++)p(f.concat(d,b),null);n.length=e.length;b=0;for(h=e.length;b<
h;b++)g(n,e,b,f.concat(d),q)}else{if(!angular.isObject(n)||angular.isArray(n))p(f.concat(d),e),b[d]=n=angular.copy(e);for(h in e)e.hasOwnProperty(h)&&g(n,e,h,f.concat(d),q);for(h in n)e.hasOwnProperty(h)||(delete n[h],p(f.concat(d,h),null))}else e!==n&&(b[d]=e,p(f.concat(d),e))}}var q={};q[d]=angular.copy(b[d]);return{savedScope:q,compare:function(){g(q,b,d,[],6)},destroy:function(){q&&delete q[d];q=null}}}};return t}]);
(function(){function t(b,d){angular.forEach(d,function(d,e){var q=b[e];b[e]=function(){var b=arguments[d]||angular.noop,g=Array.prototype.slice.call(arguments),n=this;g[d]=function(d){var g=b.apply(this,arguments);d&&g!==Firebase.IGNORE_ERROR&&angular.forEach(f,function(b){b(d,n,e)})};return q.apply(this,g)}});return b}function b(d){t(d,{on:2,once:2});angular.forEach(["limit","startAt","endAt"],function(f){var p=d[f];d[f]=function(){return b(p.apply(this,arguments))}});return d}function d(){if(!p){t(Firebase.prototype,
{auth:1,set:1,update:1,setWithPriority:2,setPriority:1,transaction:1});var d=Firebase.prototype.onDisconnect;Firebase.prototype.onDisconnect=function(){return t(d.apply(this,arguments),{set:1,setWithPriority:2,update:1,remove:0,cancel:0})};b(Firebase.prototype);p=!0}}Firebase.IGNORE_ERROR={};var f=[],p=!1;Firebase.onError=function(b){d();f.push(b);return b};Firebase.offError=function(b){b=f.indexOf(b);-1!==b&&f.splice(b,1)}})();}).call(window);
