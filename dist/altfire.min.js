(function(window, undefined){angular.module("altfire",[]).factory("fire",["$interpolate","$q","$timeout","$rootScope","orderByFilter","fireHelpers",function(t,d,e,h,m,k){function r(a){var b=g(a.ref().toString(),a.name(),a.val());a.hasChildren()&&null!==a.getPriority()&&Object.defineProperty(b,".priority",{value:a.getPriority()});return b}function z(a){1<arguments.length&&(a+="/"+Array.prototype.slice.call(arguments,1).join("/"));return new Firebase(a)}function g(a,b,c){var f;angular.isArray(c)?f=H(a)||{}:angular.isObject(c)&&
(f=H(a)||c);f&&(Object.defineProperty(f,"$key",{value:b}),Object.defineProperty(f,"$ref",{value:angular.bind(null,z,a)}),angular.forEach(c,function(b,c){null===b||angular.isUndefined(b)||(f[c]=g(a+"/"+c,c,b))}));return f||c}function u(a,b){function c(a){return new Firebase(a.slice(0,a.indexOf("/",8)+1)+".info/serverTimeOffset")}b&&c(b).off("value",D);if(a)c(a).on("value",D)}function D(a){I=a.val()}function A(a,b){if(a in v)return v[a];Object.keys(v).length>=L&&(v={});if(angular.isString(a)){var c=
"https://"===a.slice(0,8);if(a&&(-1!==(c?a.slice(8):a).indexOf("//")||"/"===a.charAt(a.length-1)||"/"===a.charAt(0))){try{throw Error("Invalid path interpolation: "+a);}catch(f){if(b)throw f;/\baltfire\b/.test(f.stack)&&console.log(f.stack.replace(/\n[^\n]*(altfire|angular(\.min)?)\.js[^\n]*$/gm,""))}return v[a]=null}if(!c){if(!w)throw Error("Relative path given and default root not specified.");a=v[a]=w+a}}return a}function s(a,b,c,f,q){function d(a){return[A(h?h(a):b,q),A(g?g(a):c,q)]}a.$watch||
(q=!0);c&&-1===b.search("#")&&(b+="/#");var h=angular.isString(b)?t(b,!0):void 0,g=angular.isString(c)?t(c,!0):void 0;!q&&a.$watch&&a.$watch(d,function(a){k&&angular.equals(a,k)||(k=null,f.apply(null,a))},!0);var k=d(a);f.apply(null,k)}function l(a,b,c){this.onChange=a.onChange;this.onCollectionChange=a.onCollectionChange;this.change=!1;this.addedKeys=[];this.removedKeys=[];this.movedKeys=[];this.allKeys=[];this.fireChangesAsync=angular.bind(h,h.$evalAsync,angular.bind(this,this.fireChanges));var f=
a.child?t(a.child,!0):null;h.$watch(function(){var q=b.ref();if(!q)return null;q=q.toString();if(a.child){var d=a.child;if(f&&(d=f(c),-1!==d.indexOf("//")||"/"===d.charAt(d.length-1)||"/"===d.charAt(0)))return null;q=q+"/"+d}return q},angular.bind(this,function(a){this.ref&&this.unlisten();this.ref=a?new Firebase(a):null;this.change=!0;this.addedKeys=[];this.movedKeys=[];this.removedKeys=this.allKeys;this.allKeys=[];this.ref?this.listen():this.fireChangesAsync()}))}function B(a,b,c,f,q,g,z,E){function u(a,
b,f){var c=a.toString();C[c]||(C[c]={});C[c][b]||(C[c][b]=[]);C[c][b].push(f);a.on(b,f)}function l(a){var b=C[a.toString()];b&&angular.forEach(b,function(b,c){angular.forEach(b,function(b){a.off(c,b)})});delete C[a.toString()]}function s(){if("via"===q)u(g,"value",function(c){f&&(w([],a[b]),delete a[b]);if(c.hasChildren())throw Error("via value of "+g+" must not be an object, ignoring: "+c.val());n.filterValue=c.val();n.ref=f=new Firebase(F.replace("#",n.filterValue));v([],t)});else if("viaKeys"===
q||"viaValues"===q)a[b]=a[b]||{},u(g,"value",function(a){n.filterValue=r(a);n.filterValue?angular.forEach(n.filterValue,function(a,b){"$"!==b.charAt(0)&&m("viaKeys"===q?b:z(a),!0)}):p()}),u(g,"child_removed",function(a){m(a.name(),!1)});else if("viaIds"===q)if(a[b]=a[b]||{},n.filterValue=g,g.length)for(var c=0;c<g.length;c++)m(g[c],!0);else p()}function J(a,b){if((n.isReady||angular.isObject(b))&&!angular.isUndefined(b)){var c=A(a);b=k.fireCopy(b);angular.isObject(b)&&!angular.isArray(b)?c.update(b):
c.set(b)}}function m(c,f){if(c&&!!n.allowedKeys[c]!==f)if(f)n.allowedKeys[c]=!0,v([c],D(c));else{var d=a[b]&&a[b][c];B("child_removed",[],c);w([c],d);delete n.allowedKeys[c]}}function t(f){n.isReady?angular.isObject(f)&&angular.isObject(a[b])||(a[b]=f,x&&(x.savedScope[b]=angular.copy(f))):(a[b]=k.fireMerge(f,a[b]),p(),"bind"===c&&n.ready().then(function(){J([],a[b])}));E()}function D(c){return function(f){angular.isObject(f)&&angular.isObject(a[b]&&a[b][c])||angular.isUndefined(a[b])||(a[b][c]=f,
x&&(x.savedScope[b][c]=angular.copy(f)),!n.isReady&&Object.keys(n.allowedKeys).every(function(c){return a[b].hasOwnProperty(c)})&&p(),n.isReady&&E())}}function p(){n.isReady||(n.isReady=!0,e(function(){y.resolve()}))}function A(a){var b;F&&"via"!==q?(b=new Firebase(F.replace("#",a[0])),1<a.length&&(b=b.child(a.slice(1).join("/")))):b=a.length?(f.ref?f.ref():f).child(a.join("/")):f;return b}function v(a,b){a=a||[];var c=A(a);u(c,"child_added",function(b){var c=r(b);b.hasChildren()&&v(a.concat(b.name()));
B("child_added",a,b.name(),c)});u(c,"child_removed",function(b){w(a.concat(b.name()),r(b));B("child_removed",a,b.name())});u(c,"child_changed",function(b){b.hasChildren()||B("child_changed",a,b.name(),b.val())});b&&u(c,"value",function(a){b(r(a))})}function w(a,b){a=a||[];var c=A(a);angular.isObject(b)&&angular.forEach(b,function(b,c){angular.isString(c)&&"$"===c.charAt(0)||w(a.concat(c),b)});l(c)}function B(c,f,d,g){f=k.parsePath(b,f);switch(c){case "child_removed":k.remove(f(a),d,g);x&&k.remove(f(x.savedScope),
d);break;case "child_added":case "child_changed":k.set(f(a),d,g),x&&k.set(f(x.savedScope),d,angular.copy(g))}E()}var n={},C={};z=z||angular.identity;var y=d.defer();n.destroy=function(){angular.forEach(C,function(a,b){l(new Firebase(b))});"viaKeys"===q||"viaValues"===q?angular.forEach(a[b],function(a,b){w([b],a)}):f&&w([],a[b]);G&&G();x&&x.destroy();delete a[b]};n.isReady=!1;n.ready=function(){return y.promise};if(g){n.allowedKeys={};var F=f;f=null;s();n[q+"Ref"]=g}else v([],t),n.ref=f;var x,G;"bind"===
c&&(x=k.makeObjectReporter(a,b,J),G=h.$watch(x.compare,angular.noop));return n}var p={},w=null,K={},y=null,v={},L=5E3;p.setDefaultConstructorMap=function(a){K=angular.copy(a);y=null};var M=function(){y||(y=[],angular.forEach(K,function(a,b){var c=[],f=A(b,!0).replace(/\b\$[^\/]+/g,function(a){c.push(a);return"([^/]+)"});y.push({constructor:a,variables:c,regex:RegExp("^"+f.replace(/[$-.?[-^{|}]/g,"\\$&")+"$")})}));return y},H=function(a){for(var b=M(),c=0;c<b.length;c++){var f=b[c];f.regex.lastIndex=
0;var d=f.regex.exec(a);if(d){a=new f.constructor;for(b=0;b<f.variables.length;b++)Object.defineProperty(a,f.variables[b],{value:d[b+1]});return a}}};p.setDefaultRoot=function(a){angular.isString(a)||(a=a.toString());if(0!==a.search(/^https?:\/\//))throw Error("Firebase root URL must start with http(s)://, got: "+a);"/"!==a.charAt(a.length-1)&&(a+="/");u(a,w);w=a;v={};y=null};var I=0;p.getDefaultServerTimestamp=function(){return(new Date).getTime()+I};p.ref=function(a,b){return new Firebase(A(t(b)(a)))};
p.connectOne=function(a){function b(b){a.query&&(b=a.query(b));return b}if(!a.name)throw Error("Must provide a name for the connection.");if(1!==("bind"in a)+("pull"in a)+("once"in a)+("noop"in a))throw Error('Each connection must specify exactly one of "bind", "pull", "once" and "noop".');var c,f;angular.forEach(["bind","pull","once","noop"],function(b){b in a&&(c=b,f=a[b])});var g="ref",k,u;angular.forEach(["via","viaKeys","viaValues","viaIds"],function(b){if(b in a){if(k)throw Error('A connection can specify at most one of "via", "viaKeys", "viaValues", and "viaIds".');
k=b;"viaIds"===b?g=null:(u=a[b],g=b+"Ref")}});if(k&&("once"===c||"noop"===c))throw Error('Cannot combine "'+k+'" with "once" or "noop".');if(a.watch&&k&&"via"!==k)throw Error('Cannot yet combine "'+k+'" with "watch".');if(a.viaValueExtractor&&"viaValues"!==k)throw Error('Can only use "viaValueExtractor" with "viaValues".');if("viaIds"===k&&a.query)throw Error('Cannot combine "viaIds" with "query".');a.digest=a.digest||_.bind(h.$evalAsync,h);var e,z=d.defer();s(a.pathScope||a.scope,f,u,function(f,
h){e&&(e.destroy(),e=null);if("noop"===c&&f)e={destroy:angular.noop,isReady:!0,ready:function(){return d.when()}},e[g]=b(new Firebase(f));else if("once"===c&&f){var l=d.defer(),p=e={destroy:angular.noop,isReady:!1,ready:function(){return l.promise}};e[g]=b(new Firebase(f));e[g].once("value",function(b){e===p&&(a.scope[a.name]=r(b),e.isReady=!0,l.resolve())})}else!f||u&&!h||(e=h?B(a.scope,a.name,c,f,k,b(new Firebase(h)),a.viaValueExtractor,a.digest):"viaIds"===k?B(a.scope,a.name,c,f,k,a.viaIds,null,
a.digest):B(a.scope,a.name,c,b(new Firebase(f)),null,null,null,a.digest));e&&z.resolve(e)});var m=[],p={destroy:function(){e&&e.destroy();angular.forEach(m,function(a){a.destroy()})},isReady:function(){return e&&e.isReady},ready:function(){return z.promise.then(function(a){return a.ready()})},allowedKeys:function(){return e&&e.allowedKeys}};a.scope.$on&&a.scope.$on("$destroy",p.destroy);g&&(p[g]=function(){var a=e&&e[g];a&&(a.ref&&(a=a.ref()),arguments.length&&(a=a.child(Array.prototype.slice.call(arguments,
0).join("/"))));return a});"via"===k&&(p.ref=function(){var a=e&&e.ref;a&&(a.ref&&(a=a.ref()),arguments.length&&(a=a.child(Array.prototype.slice.call(arguments,0).join("/"))));return a});k&&(p[k]=function(){return e&&e.filterValue});angular.forEach(a.watch,function(b){m.push(new l(b,p,a.pathScope||a.scope))});return p};p.connect=function(a,b){var c={};angular.forEach(b,function(b,d){b.scope=a;b.name=d;c[d]=p.connectOne(b)});c.$allReady=function(){var b=[],g=[];angular.forEach(c,function(a,c){"$"!==
c.charAt(0)&&(b.push(c),g.push(a.ready()))});return d.all(g).then(function(){var c={};angular.forEach(b,function(b){c[b]=a[b]});return c})};c.$areAllReady=function(){var a=!0;angular.forEach(c,function(b,c){"$"!==c.charAt(0)&&(a=a&&b.isReady())});return a};c.$destroyAll=function(){angular.forEach(c,function(a,b){"$"!==b.charAt(0)&&a.destroy()})};return c};p.toArrayOrderedByKey=function(a){var b=[];a&&(angular.forEach(a,function(a,f){angular.isObject(a)&&b.push(a)}),m(b,"$key"));return b};p.generateUniqueKey=
function(){return(new Firebase(w)).push().name()};l.prototype.listen=function(){if(this.onChange)this.ref.on("value",this.valueChanged,this);this.onCollectionChange&&(this.ref.on("child_added",this.childAdded,this),this.ref.on("child_removed",this.childRemoved,this),this.ref.on("child_moved",this.childMoved,this))};l.prototype.unlisten=function(){this.onChange&&this.ref.off("value",this.valueChanged,this);this.onCollectionChange&&(this.ref.off("child_added",this.childAdded,this),this.ref.off("child_removed",
this.childRemoved,this),this.ref.off("child_moved",this.childMoved,this))};l.prototype.destroy=function(){this.ref&&this.unlisten()};l.prototype.valueChanged=function(){this.change=!0;this.fireChangesAsync()};l.prototype.childAdded=function(a){this.addedKeys.push(a.name());a=this.removedKeys.indexOf(a.name());0<=a&&this.removedKeys.splice(a,1);this.fireChangesAsync()};l.prototype.childRemoved=function(a){this.removedKeys.push(a.name());var b=this.addedKeys.indexOf(a.name());0<=b&&this.addedKeys.splice(b,
1);b=this.movedKeys.indexOf(a.name());0<=b&&this.movedKeys.splice(b,1);b=this.allKeys.indexOf(a.name());0<=b&&this.allKeys.splice(b,1);this.fireChangesAsync()};l.prototype.childMoved=function(a){this.movedKeys.push(a.name());this.fireChangesAsync()};l.prototype.fireChanges=function(){this.onChange&&this.change&&(this.change=!1,this.onChange());if(this.onCollectionChange&&(this.addedKeys.length||this.removedKeys.length||this.movedKeys.length)){var a=this.addedKeys,b=this.removedKeys,c=this.movedKeys;
this.allKeys.push.apply(this.allKeys,a);angular.forEach(b,function(a){a=this.allKeys.indexOf(a);0<=a&&this.allKeys.splice(a,1)},this);this.addedKeys=[];this.removedKeys=[];this.movedKeys=[];this.onCollectionChange(a,b,c)}};return p}]).filter("escapeFirebase",function(){return function(t){return t.toString().replace(/[\\\.\$\#\[\]\/]/g,function(d){return"\\"+d.charCodeAt(0).toString(16)})}}).factory("fireHelpers",[function(){var t={remove:function(d,e){angular.isArray(d)?d.splice(e,1):d&&delete d[e]},
set:function(d,e,h){d&&(d[e]=h)},parsePath:function(d,e){return function(h){h=h[d];for(var m=0,k=e.length;m<k;m++){if(null===h||angular.isUndefined(h))return;h=h[e[m]]}return h}},fireCopy:function(d){if(angular.isObject(d)){var e=angular.isArray(d)?Array(d.length):{},h;for(h in d)d.hasOwnProperty(h)&&("$"!==h.charAt(0)&&angular.isDefined(d[h]))&&(angular.isObject(d[h])?e[h]=t.fireCopy(d[h]):e[h]=d[h]);return e}return d},fireMerge:function(d,e){if(angular.equals(d,e))return e;if(angular.isArray(d)&&
angular.isArray(e))return e.concat(d);if(angular.isObject(d)&&angular.isObject(e)){for(var h in d)e[h]=d[h];return e}return(angular.isUndefined(d)||null===d)&&angular.isDefined(e)?e:d},makeObjectReporter:function(d,e,h){function m(d,g){angular.isUndefined(g)&&(g=null);d.shift();h(d,g)}function k(d,g,e,h,r){if(!e.charAt||"$"!==e.charAt(0)){r--;if(!r&&!angular.equals(d[e],g[e]))return d[e]=angular.copy(g[e]),m(h.concat(e),g[e]);g=g[e];var s=d[e],l;if(angular.isObject(g))if(angular.isArray(g)){angular.isArray(s)||
(m(h.concat(e),g),d[e]=s=g.slice());if(s.length>g.length)for(d=g.length,l=s.length;d<l;d++)m(h.concat(e,d),null);s.length=g.length;d=0;for(l=g.length;d<l;d++)k(s,g,d,h.concat(e),r)}else{if(!angular.isObject(s)||angular.isArray(s))m(h.concat(e),g),d[e]=s=angular.copy(g);for(l in g)g.hasOwnProperty(l)&&k(s,g,l,h.concat(e),r);for(l in s)g.hasOwnProperty(l)||(delete s[l],m(h.concat(e,l),null))}else g!==s&&(d[e]=g,m(h.concat(e),g))}}var r={};r[e]=angular.copy(d[e]);return{savedScope:r,compare:function(){k(r,
d,e,[],6)},destroy:function(){r&&delete r[e];r=null}}}};return t}]);
(function(){function t(d,e){angular.forEach(e,function(e,g){var m=d[g];d[g]=function(){var d=_.isFunction(arguments[e])||_.isUndefined(arguments[e]),k=arguments[e]||angular.noop,r=Array.prototype.slice.call(arguments),l=this;r.splice(e,d?1:0,function(d){var e=k.apply(this,arguments);d&&e!==Firebase.IGNORE_ERROR&&angular.forEach(h,function(e){e(d,l,g)})});return m.apply(this,r)}});return d}function d(e){t(e,{on:2,once:2});angular.forEach(["limit","startAt","endAt"],function(h){var m=e[h];e[h]=function(){return d(m.apply(this,
arguments))}});return e}function e(){if(!m){t(Firebase.prototype,{auth:1,set:1,update:1,setWithPriority:2,setPriority:1,transaction:1});var e=Firebase.prototype.onDisconnect;Firebase.prototype.onDisconnect=function(){return t(e.apply(this,arguments),{set:1,setWithPriority:2,update:1,remove:0,cancel:0})};d(Firebase.prototype);m=!0}}Firebase.IGNORE_ERROR={};var h=[],m=!1;Firebase.onError=function(d){e();h.push(d);return d};Firebase.offError=function(d){d=h.indexOf(d);-1!==d&&h.splice(d,1)}})();}).call(window);
