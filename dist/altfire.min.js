(function(window, undefined){angular.module("altfire",[]).factory("fire",["$interpolate","$q","$timeout","$rootScope","orderByFilter","fireHelpers",function(s,b,f,d,m,h){function r(a){var c=k(a.ref().toString(),a.val());a.hasChildren()&&null!==a.getPriority()&&(c[".priority"]=a.getPriority());return c}function k(a,c){var n;angular.isObject(c)?n=D(a)||c:angular.isArray(c)&&(n=D(a)||{});n&&angular.forEach(c,function(c,b){null===c||angular.isUndefined(c)||(n[b]=k(a+"/"+b,c))});return n||c}function e(a,c){function n(a){return new Firebase(a.slice(0,
a.indexOf("/",8)+1)+".info/serverTimeOffset")}c&&n(c).off("value",t);if(a)n(a).on("value",t)}function t(a){I=a.val()}function x(a,c){if(a in u)return u[a];Object.keys(u).length>=K&&(u={});if(angular.isString(a)){var n="https://"===a.slice(0,8);if(a&&(-1!==(n?a.slice(8):a).indexOf("//")||"/"===a.charAt(a.length-1)||"/"===a.charAt(0))){try{throw Error("Invalid path interpolation: "+a);}catch(b){if(c)throw b;console.log(b.stack.replace(/\n[^\n]*(altfire|angular(\.min)?)\.js[^\n]*$/gm,""))}return u[a]=
null}if(!n){if(!z)throw Error("Relative path given and default root not specified.");a=u[a]=z+a}}return a}function E(a,c,b,H,q){function d(a){return[x(h?h(a):c,q),x(e?e(a):b,q)]}a.$watch||(q=!0);b&&-1===c.search("#")&&(c+="/#");var h=angular.isString(c)?s(c,!1):void 0,e=angular.isString(b)?s(b,!1):void 0;!q&&a.$watch&&a.$watch(d,function(a){f&&angular.equals(a,f)||(f=null,H.apply(null,a))},!0);var f=d(a);H.apply(null,f)}function p(a,c,n,e,q,v,k){function t(){v&&(J(v),l.allowedKeys={});"viaKeys"===
q||"viaValues"===q?angular.forEach(a[c],function(a,c){C([c],a)}):e&&C([],a[c]);F&&F();w&&w.destroy();delete a[c]}function g(a,c,b){var e=a.toString();A[e]||(A[e]={});A[e][c]||(A[e][c]=[]);A[e][c].push(b);a.on(c,b)}function J(a){var c=A[a.toString()];c&&angular.forEach(c,function(c,b){angular.forEach(c,function(c){a.off(b,c)})});delete A[a.toString()]}function p(){if("via"===q)g(v,"value",function(b){e&&(C([],a[c]),delete a[c]);if(b.hasChildren())throw Error("via value of "+v+" must not be an object, ignoring: "+
b.val());l.filterValue=b.val();e=new Firebase(G.replace("#",l.filterValue));y([],s)});else if("viaKeys"===q||"viaValues"===q)a[c]=a[c]||{},g(v,"value",function(a){l.filterValue=r(a);l.filterValue?angular.forEach(l.filterValue,function(a,c){"$"!==c.charAt(0)&&x("viaKeys"===q?c:k(a),!0)}):u()}),g(v,"child_removed",function(a){x(a.name(),!1)});else if("viaIds"===q)if(a[c]=a[c]||{},l.filterValue=v,v.length)for(var b=0;b<v.length;b++)x(v[b],!0);else u()}function m(a,c){if((l.isReady||angular.isObject(c))&&
!angular.isUndefined(c)){var b=z(a);c=h.fireCopy(c);angular.isObject(c)&&!angular.isArray(c)?b.update(c):b.set(c)}}function x(b,e){if(b&&!!l.allowedKeys[b]!==e)if(e)l.allowedKeys[b]=!0,y([b],E(b));else{var n=a[c]&&a[c][b];B("child_removed",[],b);C([b],n);delete l.allowedKeys[b]}}function s(b){d.$evalAsync(function(){l.isReady?angular.isObject(b)&&angular.isObject(a[c])||(a[c]=b,w&&(w.savedScope[c]=angular.copy(b))):(a[c]=h.fireMerge(b,a[c]),u(),"bind"===n&&l.ready().then(function(){m([],a[c])}))})}
function E(b){return function(e){angular.isObject(e)&&angular.isObject(a[c]&&a[c][b])||angular.isUndefined(a[c])||(a[c][b]=e,w&&(w.savedScope[c][b]=angular.copy(e)),!l.isReady&&Object.keys(l.allowedKeys).every(function(b){return a[c].hasOwnProperty(b)})&&u(),l.isReady&&d.$evalAsync(function(){}))}}function u(){l.isReady||(l.isReady=!0,f(function(){D.resolve()}))}function z(a){var c;G&&"via"!==q?(c=new Firebase(G.replace("#",a[0])),1<a.length&&(c=c.child(a.slice(1).join("/")))):c=a.length?(e.ref?e.ref():
e).child(a.join("/")):e;return c}function y(a,c){a=a||[];var b=z(a);g(b,"child_added",function(c){var b=r(c);c.hasChildren()&&y(a.concat(c.name()));B("child_added",a,c.name(),b)});g(b,"child_removed",function(c){C(a.concat(c.name()),r(c));B("child_removed",a,c.name())});g(b,"child_changed",function(c){c.hasChildren()||B("child_changed",a,c.name(),c.val())});c&&g(b,"value",function(a){c(r(a))})}function C(a,c){a=a||[];var b=z(a);angular.isObject(c)&&angular.forEach(c,function(c,b){angular.isString(b)&&
"$"===b.charAt(0)||C(a.concat(b),c)});J(b)}function B(b,e,n,q){d.$evalAsync(function(){var d=h.parsePath(c,e);switch(b){case "child_removed":h.remove(d(a),n,q);w&&h.remove(d(w.savedScope),n);break;case "child_added":case "child_changed":h.set(d(a),n,q),w&&h.set(d(w.savedScope),n,angular.copy(q))}})}var l={},A={};k=k||angular.identity;var D=b.defer();a.$on&&a.$on("$destroy",t);l.destroy=t;l.isReady=!1;l.ready=function(){return D.promise};if(v){l.allowedKeys={};var G=e;e=null;p();l[q+"Ref"]=v}else y([],
s),l.ref=e;var w,F;"bind"===n&&(w=h.makeObjectReporter(a,c,m),F=d.$watch(w.compare,angular.noop));return l}var g={},z=null,B={},y=null,u={},K=5E3;g.setDefaultConstructorMap=function(a){B=angular.copy(a);y=null};var L=function(){y||(y=[],angular.forEach(B,function(a,c){var b=[],e=x(c,!0).replace(/\b\$[^\/]+/g,function(a){b.push(a);return"([^/]+)"});y.push({constructor:a,variables:b,regex:RegExp("^"+e.replace(/[$-.?[-^{|}]/g,"\\$&")+"$")})}));return y},D=function(a){for(var c=L(),b=0;b<c.length;b++){var e=
c[b];e.regex.lastIndex=0;var d=e.regex.exec(a);if(d){a=new e.constructor;for(c=0;c<e.variables.length;c++)a[e.variables[c]]=d[c+1];return a}}};g.setDefaultRoot=function(a){angular.isString(a)||(a=a.toString());if(0!==a.search(/^https?:\/\//))throw Error("Firebase root URL must start with http(s)://, got: "+a);"/"!==a.charAt(a.length-1)&&(a+="/");e(a,z);z=a;u={};y=null};var I=0;g.getDefaultServerTimestamp=function(){return(new Date).getTime()+I};g.ref=function(a,c){return new Firebase(x(s(c)(a)))};
g.connectOne=function(a){function c(c){a.query&&(c=a.query(c));return c}if(!a.name)throw Error("Must provide a name for the connection.");if(1!==("bind"in a)+("pull"in a)+("once"in a)+("noop"in a))throw Error('Each connection must specify exactly one of "bind", "pull", "once" and "noop".');var e,d;angular.forEach(["bind","pull","once","noop"],function(c){c in a&&(e=c,d=a[c])});var h="ref",f,g;angular.forEach(["via","viaKeys","viaValues","viaIds"],function(c){if(c in a){if(f)throw Error('A connection can specify at most one of "via", "viaKeys", "viaValues", and "viaIds".');
f=c;"viaIds"===c?h=null:(g=a[c],h=c+"Ref")}});if(f&&("once"===e||"noop"===e))throw Error('Cannot combine via* with "once" or "noop".');if(a.viaValueExtractor&&"viaValues"!==f)throw Error('Can only use "viaValueExtractor" with "viaValues".');if("viaIds"===f&&a.query)throw Error("Cannot combine viaIds with a query.");var k;E(a.pathScope||a.scope,d,g,function(d,t){k&&(k.destroy(),k=null);if("noop"===e&&d)k={destroy:angular.noop,isReady:!0,ready:function(){return b.when()}},k[h]=c(new Firebase(d));else if("once"===
e&&d){var x=b.defer(),m=k={destroy:angular.noop,isReady:!1,ready:function(){return x.promise}};k[h]=c(new Firebase(d));k[h].once("value",function(c){k===m&&(a.scope[a.name]=r(c),k.isReady=!0,x.resolve())})}else!d||g&&!t||(k=t?p(a.scope,a.name,e,d,f,c(new Firebase(t)),a.viaValueExtractor):"viaIds"===f?p(a.scope,a.name,e,d,f,a.viaIds):p(a.scope,a.name,e,c(new Firebase(d))))});var t={destroy:function(){k&&k.destroy()},isReady:function(){return k&&k.isReady},ready:function(){return k&&k.ready()},allowedKeys:function(){return k&&
k.allowedKeys}};h&&(t[h]=function(){var a=k[h];a.ref&&(a=a.ref());arguments.length&&(a=a.child(Array.prototype.slice.call(arguments,0).join("/")));return a});f&&(t[f]=function(){return k.filterValue});return t};g.connect=function(a,c){var e={};angular.forEach(c,function(c,b){c.scope=a;c.name=b;e[b]=g.connectOne(c)});e.$allReady=function(){var c=[],d=[];angular.forEach(e,function(a,b){"$"!==b.charAt(0)&&(c.push(b),a.ready()&&d.push(a.ready()))});return b.all(d).then(function(){var b={};angular.forEach(c,
function(c){b[c]=a[c]});return b})};e.$destroyAll=function(){angular.forEach(e,function(a,c){"$"!==c.charAt(0)&&a.destroy()})};return e};g.toArrayOrderedByKey=function(a){var c=[];a&&(angular.forEach(a,function(a,b){angular.isObject(a)&&(a.$key=b,c.push(a))}),m(c,"$key"));return c};return g}]).factory("fireHelpers",[function(){var s={remove:function(b,f){angular.isArray(b)?b.splice(f,1):b&&delete b[f]},set:function(b,f,d){b&&(b[f]=d)},parsePath:function(b,f){return function(d){d=d[b];for(var m=0,
h=f.length;m<h;m++){if(angular.isUndefined(d))return;d=d[f[m]]}return d}},fireCopy:function(b){if(angular.isObject(b)){var f=angular.isArray(b)?Array(b.length):{},d;for(d in b)b.hasOwnProperty(d)&&("$"!==d.charAt(0)&&angular.isDefined(b[d]))&&(angular.isObject(b[d])?f[d]=s.fireCopy(b[d]):f[d]=b[d]);return f}return b},fireMerge:function(b,f){if(angular.equals(b,f))return f;if(angular.isArray(b)&&angular.isArray(f))return f.concat(b);if(angular.isObject(b)&&angular.isObject(f)){for(var d in b)f[d]=
b[d];return f}return(angular.isUndefined(b)||null===b)&&angular.isDefined(f)?f:b},makeObjectReporter:function(b,f,d){function m(b,e){angular.isUndefined(e)&&(e=null);b.shift();d(b,e)}function h(b,e,d,f,r){if(!d.charAt||"$"!==d.charAt(0)){r--;if(!r&&!angular.equals(b[d],e[d]))return b[d]=angular.copy(e[d]),m(f.concat(d),e[d]);e=e[d];var p=b[d],g;if(angular.isObject(e))if(angular.isArray(e)){angular.isArray(p)||(m(f.concat(d),e),b[d]=p=e.slice());if(p.length>e.length)for(b=e.length,g=p.length;b<g;b++)m(f.concat(d,
b),null);p.length=e.length;b=0;for(g=e.length;b<g;b++)h(p,e,b,f.concat(d),r)}else{if(!angular.isObject(p)||angular.isArray(p))m(f.concat(d),e),b[d]=p=angular.copy(e);for(g in e)e.hasOwnProperty(g)&&h(p,e,g,f.concat(d),r);for(g in p)e.hasOwnProperty(g)||(delete p[g],m(f.concat(d,g),null))}else e!==p&&(b[d]=e,m(f.concat(d),e))}}var r={};r[f]=angular.copy(b[f]);return{savedScope:r,compare:function(){h(r,b,f,[],6)},destroy:function(){r&&delete r[f];r=null}}}};return s}]);
(function(){function s(b,f){angular.forEach(f,function(f,e){var m=b[e];b[e]=function(){var b=arguments[f]||angular.noop,h=Array.prototype.slice.call(arguments),p=this;h[f]=function(f){var h=b.apply(this,arguments);f&&h!==Firebase.IGNORE_ERROR&&angular.forEach(d,function(b){b(f,p,e)})};return m.apply(this,h)}});return b}function b(d){s(d,{on:2,once:2});angular.forEach(["limit","startAt","endAt"],function(f){var k=d[f];d[f]=function(){return b(k.apply(this,arguments))}});return d}function f(){if(!m){s(Firebase.prototype,
{auth:1,set:1,update:1,setWithPriority:2,setPriority:1,transaction:1});var d=Firebase.prototype.onDisconnect;Firebase.prototype.onDisconnect=function(){return s(d.apply(this,arguments),{set:1,setWithPriority:2,update:1,remove:0,cancel:0})};b(Firebase.prototype);m=!0}}Firebase.IGNORE_ERROR={};var d=[],m=!1;Firebase.onError=function(b){f();d.push(b);return b};Firebase.offError=function(b){b=d.indexOf(b);-1!==b&&d.splice(b,1)}})();}).call(window);
