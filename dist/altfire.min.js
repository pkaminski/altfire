(function(window, undefined){angular.module("altfire",[]).factory("fire",["$interpolate","$q","$timeout","$rootScope","orderByFilter","fireHelpers",function(s,c,g,e,n,k){function p(a){var b=r(a.ref().toString(),a.val());a.hasChildren()&&null!==a.getPriority()&&(b[".priority"]=a.getPriority());return b}function r(a,b){var d;angular.isObject(b)?d=D(a)||b:angular.isArray(b)&&(d=D(a)||{});d&&angular.forEach(b,function(b,c){null===b||angular.isUndefined(b)||(d[c]=r(a+"/"+c,b))});return d||b}function f(a,b){function d(a){return new Firebase(a.slice(0,
a.indexOf("/",8)+1)+".info/serverTimeOffset")}b&&d(b).off("value",y);if(a)d(a).on("value",y)}function y(a){H=a.val()}function x(a,b){if(a in t)return t[a];Object.keys(t).length>=J&&(t={});if(angular.isString(a)){var d="https://"===a.slice(0,8);if(a&&(-1!==(d?a.slice(8):a).indexOf("//")||"/"===a.charAt(a.length-1)||"/"===a.charAt(0))){try{throw Error("Invalid path interpolation: "+a);}catch(c){if(b)throw c;console.log(c.stack.replace(/\n[^\n]*(altfire|angular(\.min)?)\.js[^\n]*$/gm,""))}return t[a]=
null}if(!d){if(!z)throw Error("Relative path given and default root not specified.");a=t[a]=z+a}}return a}function E(a,b,d,c,q){function e(a){return[x(k?k(a):b,q),x(f?f(a):d,q)]}a.$watch||(q=!0);d&&-1===b.search("#")&&(b+="/#");var k=angular.isString(b)?s(b,!1):void 0,f=angular.isString(d)?s(d,!1):void 0;!q&&a.$watch&&a.$watch(e,function(a){g&&angular.equals(a,g)||(g=null,c.apply(null,a))},!0);var g=e(a);c.apply(null,g)}function m(a,b,d,f,q,u,r){function y(){u&&(I(u),l.allowedKeys={});"viaKeys"===
q||"viaValues"===q?angular.forEach(a[b],function(a,b){C([b],a)}):f&&C([],a[b]);F&&F();v&&v.destroy();delete a[b]}function h(a,b,c){var d=a.toString();A[d]||(A[d]={});A[d][b]||(A[d][b]=[]);A[d][b].push(c);a.on(b,c)}function I(a){var b=A[a.toString()];b&&angular.forEach(b,function(b,d){angular.forEach(b,function(b){a.off(d,b)})});delete A[a.toString()]}function m(){if("via"===q)h(u,"value",function(d){f&&(C([],a[b]),delete a[b]);if(d.hasChildren())throw Error("via value of "+u+" must not be an object, ignoring: "+
d.val());l.filterValue=d.val();f=new Firebase(G.replace("#",l.filterValue));w([],s)});else if("viaKeys"===q||"viaValues"===q)a[b]=a[b]||{},h(u,"value",function(a){l.filterValue=p(a);l.filterValue?angular.forEach(l.filterValue,function(a,b){"$"!==b.charAt(0)&&x("viaKeys"===q?b:r(a),!0)}):t()}),h(u,"child_removed",function(a){x(a.name(),!1)});else if("viaIds"===q)if(a[b]=a[b]||{},l.filterValue=u,u.length)for(var d=0;d<u.length;d++)x(u[d],!0);else t()}function n(a,b){if((l.isReady||angular.isObject(b))&&
!angular.isUndefined(b)){var d=z(a);b=k.fireCopy(b);angular.isObject(b)&&!angular.isArray(b)?d.update(b):d.set(b)}}function x(d,c){if(d&&!!l.allowedKeys[d]!==c)if(c)l.allowedKeys[d]=!0,w([d],E(d));else{var f=a[b]&&a[b][d];B("child_removed",[],d);C([d],f);delete l.allowedKeys[d]}}function s(c){e.$evalAsync(function(){l.isReady?angular.isObject(c)&&angular.isObject(a[b])||(a[b]=c,v&&(v.savedScope[b]=angular.copy(c))):(a[b]=k.fireMerge(c,a[b]),t(),"bind"===d&&l.ready().then(function(){n([],a[b])}))})}
function E(d){return function(c){angular.isObject(c)&&angular.isObject(a[b]&&a[b][d])||angular.isUndefined(a[b])||(a[b][d]=c,v&&(v.savedScope[b][d]=angular.copy(c)),!l.isReady&&Object.keys(l.allowedKeys).every(function(d){return a[b].hasOwnProperty(d)})&&t(),l.isReady&&e.$evalAsync(function(){}))}}function t(){l.isReady||(l.isReady=!0,g(function(){D.resolve()}))}function z(a){var b;G&&"via"!==q?(b=new Firebase(G.replace("#",a[0])),1<a.length&&(b=b.child(a.slice(1).join("/")))):b=a.length?(f.ref?f.ref():
f).child(a.join("/")):f;return b}function w(a,b){a=a||[];var d=z(a);h(d,"child_added",function(b){var d=p(b);b.hasChildren()&&w(a.concat(b.name()));B("child_added",a,b.name(),d)});h(d,"child_removed",function(b){C(a.concat(b.name()),p(b));B("child_removed",a,b.name())});h(d,"child_changed",function(b){b.hasChildren()||B("child_changed",a,b.name(),b.val())});b&&h(d,"value",function(a){b(p(a))})}function C(a,b){a=a||[];var d=z(a);angular.isObject(b)&&angular.forEach(b,function(b,d){angular.isString(d)&&
"$"===d.charAt(0)||C(a.concat(d),b)});I(d)}function B(d,c,f,q){e.$evalAsync(function(){var e=k.parsePath(b,c);switch(d){case "child_removed":k.remove(e(a),f,q);v&&k.remove(e(v.savedScope),f);break;case "child_added":case "child_changed":k.set(e(a),f,q),v&&k.set(e(v.savedScope),f,angular.copy(q))}})}var l={},A={};r=r||angular.identity;var D=c.defer();a.$on&&a.$on("$destroy",y);l.destroy=y;l.isReady=!1;l.ready=function(){return D.promise};if(u){l.allowedKeys={};var G=f;f=null;m();l[q+"Ref"]=u}else w([],
s),l.ref=f;var v,F;"bind"===d&&(v=k.makeObjectReporter(a,b,n),F=e.$watch(v.compare,angular.noop));return l}var h={},z=null,B={},w=null,t={},J=5E3;h.setDefaultConstructorMap=function(a){B=angular.copy(a);w=null};var K=function(){w||(w=[],angular.forEach(B,function(a,b){var d=[],c=x(b,!0).replace(/\b\$[^\/]+/g,function(a){d.push(a);return"([^/]+)"});w.push({constructor:a,variables:d,regex:RegExp("^"+c.replace(/[$-.?[-^{|}]/g,"\\$&")+"$")})}));return w},D=function(a){for(var b=K(),d=0;d<b.length;d++){var c=
b[d];c.regex.lastIndex=0;var f=c.regex.exec(a);if(f){a=new c.constructor;for(b=0;b<c.variables.length;b++)a[c.variables[b]]=f[b+1];return a}}};h.setDefaultRoot=function(a){angular.isString(a)||(a=a.toString());if(0!==a.search(/^https?:\/\//))throw Error("Firebase root URL must start with http(s)://, got: "+a);"/"!==a.charAt(a.length-1)&&(a+="/");f(a,z);z=a;t={};w=null};var H=0;h.getDefaultServerTimestamp=function(){return(new Date).getTime()+H};h.ref=function(a,b){return new Firebase(x(s(b)(a)))};
h.connectOne=function(a){function b(b){a.query&&(b=a.query(b));return b}if(!a.name)throw Error("Must provide a name for the connection.");if(1!==("bind"in a)+("pull"in a)+("once"in a)+("noop"in a))throw Error('Each connection must specify exactly one of "bind", "pull", "once" and "noop".');var d,f;angular.forEach(["bind","pull","once","noop"],function(b){b in a&&(d=b,f=a[b])});var e="ref",k,g;angular.forEach(["via","viaKeys","viaValues","viaIds"],function(b){if(b in a){if(k)throw Error('A connection can specify at most one of "via", "viaKeys", "viaValues", and "viaIds".');
k=b;"viaIds"===b?e=null:(g=a[b],e=b+"Ref")}});if(k&&("once"===d||"noop"===d))throw Error('Cannot combine via* with "once" or "noop".');if(a.viaValueExtractor&&"viaValues"!==k)throw Error('Can only use "viaValueExtractor" with "viaValues".');if("viaIds"===k&&a.query)throw Error("Cannot combine viaIds with a query.");var h;E(a.pathScope||a.scope,f,g,function(f,r){h&&(h.destroy(),h=null);if("noop"===d&&f)h={destroy:angular.noop,isReady:!0,ready:function(){return c.when()}},h[e]=b(new Firebase(f));else if("once"===
d&&f){var y=c.defer(),x=h={destroy:angular.noop,isReady:!1,ready:function(){return y.promise}};h[e]=b(new Firebase(f));h[e].once("value",function(b){h===x&&(a.scope[a.name]=p(b),h.isReady=!0,y.resolve())})}else!f||g&&!r||(h=r?m(a.scope,a.name,d,f,k,b(new Firebase(r)),a.viaValueExtractor):"viaIds"===k?m(a.scope,a.name,d,f,k,a.viaIds):m(a.scope,a.name,d,b(new Firebase(f))))});var r={destroy:function(){h&&h.destroy()},isReady:function(){return h&&h.isReady},ready:function(){return h&&h.ready()},allowedKeys:function(){return h&&
h.allowedKeys}};e&&(r[e]=function(){var a=h[e];a.ref&&(a=a.ref());arguments.length&&(a=a.child(Array.prototype.slice.call(arguments,0).join("/")));return a});k&&(r[k]=function(){return h.filterValue});return r};h.connect=function(a,b){var d={};angular.forEach(b,function(b,c){b.scope=a;b.name=c;d[c]=h.connectOne(b)});d.$allReady=function(){var b=[],f=[];angular.forEach(d,function(a,d){"$"!==d.charAt(0)&&(b.push(d),a.ready()&&f.push(a.ready()))});return c.all(f).then(function(){var d={};angular.forEach(b,
function(b){d[b]=a[b]});return d})};d.$areAllReady=function(){var a=!0;angular.forEach(d,function(b,d){a=a&&b.isReady()});return a};d.$destroyAll=function(){angular.forEach(d,function(a,b){"$"!==b.charAt(0)&&a.destroy()})};return d};h.toArrayOrderedByKey=function(a){var b=[];a&&(angular.forEach(a,function(a,c){angular.isObject(a)&&(a.$key=c,b.push(a))}),n(b,"$key"));return b};return h}]).factory("fireHelpers",[function(){var s={remove:function(c,g){angular.isArray(c)?c.splice(g,1):c&&delete c[g]},
set:function(c,g,e){c&&(c[g]=e)},parsePath:function(c,g){return function(e){e=e[c];for(var n=0,k=g.length;n<k;n++){if(angular.isUndefined(e))return;e=e[g[n]]}return e}},fireCopy:function(c){if(angular.isObject(c)){var g=angular.isArray(c)?Array(c.length):{},e;for(e in c)c.hasOwnProperty(e)&&("$"!==e.charAt(0)&&angular.isDefined(c[e]))&&(angular.isObject(c[e])?g[e]=s.fireCopy(c[e]):g[e]=c[e]);return g}return c},fireMerge:function(c,g){if(angular.equals(c,g))return g;if(angular.isArray(c)&&angular.isArray(g))return g.concat(c);
if(angular.isObject(c)&&angular.isObject(g)){for(var e in c)g[e]=c[e];return g}return(angular.isUndefined(c)||null===c)&&angular.isDefined(g)?g:c},makeObjectReporter:function(c,g,e){function n(c,f){angular.isUndefined(f)&&(f=null);c.shift();e(c,f)}function k(c,f,e,g,p){if(!e.charAt||"$"!==e.charAt(0)){p--;if(!p&&!angular.equals(c[e],f[e]))return c[e]=angular.copy(f[e]),n(g.concat(e),f[e]);f=f[e];var m=c[e],h;if(angular.isObject(f))if(angular.isArray(f)){angular.isArray(m)||(n(g.concat(e),f),c[e]=
m=f.slice());if(m.length>f.length)for(c=f.length,h=m.length;c<h;c++)n(g.concat(e,c),null);m.length=f.length;c=0;for(h=f.length;c<h;c++)k(m,f,c,g.concat(e),p)}else{if(!angular.isObject(m)||angular.isArray(m))n(g.concat(e),f),c[e]=m=angular.copy(f);for(h in f)f.hasOwnProperty(h)&&k(m,f,h,g.concat(e),p);for(h in m)f.hasOwnProperty(h)||(delete m[h],n(g.concat(e,h),null))}else f!==m&&(c[e]=f,n(g.concat(e),f))}}var p={};p[g]=angular.copy(c[g]);return{savedScope:p,compare:function(){k(p,c,g,[],6)},destroy:function(){p&&
delete p[g];p=null}}}};return s}]);
(function(){function s(c,g){angular.forEach(g,function(g,f){var p=c[f];c[f]=function(){var c=arguments[g]||angular.noop,k=Array.prototype.slice.call(arguments),m=this;k[g]=function(h){var g=c.apply(this,arguments);h&&g!==Firebase.IGNORE_ERROR&&angular.forEach(e,function(c){c(h,m,f)})};return p.apply(this,k)}});return c}function c(e){s(e,{on:2,once:2});angular.forEach(["limit","startAt","endAt"],function(g){var n=e[g];e[g]=function(){return c(n.apply(this,arguments))}});return e}function g(){if(!n){s(Firebase.prototype,
{auth:1,set:1,update:1,setWithPriority:2,setPriority:1,transaction:1});var e=Firebase.prototype.onDisconnect;Firebase.prototype.onDisconnect=function(){return s(e.apply(this,arguments),{set:1,setWithPriority:2,update:1,remove:0,cancel:0})};c(Firebase.prototype);n=!0}}Firebase.IGNORE_ERROR={};var e=[],n=!1;Firebase.onError=function(c){g();e.push(c);return c};Firebase.offError=function(c){c=e.indexOf(c);-1!==c&&e.splice(c,1)}})();}).call(window);
