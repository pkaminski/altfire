(function(window, undefined){angular.module("altfire",[]).factory("fire",["$interpolate","$q","$timeout","$rootScope","orderByFilter","fireHelpers",function(t,c,f,e,p,g){function q(a){var b=s(a.ref().toString(),a.val());a.hasChildren()&&null!==a.getPriority()&&(b[".priority"]=a.getPriority());return b}function s(a,b){var l;angular.isObject(b)?l=D(a)||b:angular.isArray(b)&&(l=D(a)||{});l&&angular.forEach(b,function(b,c){null===b||angular.isUndefined(b)||(l[c]=s(a+"/"+c,b))});return l||b}function d(a,b){function l(a){return new Firebase(a.slice(0,
a.indexOf("/",8)+1)+".info/serverTimeOffset")}b&&l(b).off("value",y);if(a)l(a).on("value",y)}function y(a){H=a.val()}function x(a,b){if(a in u)return u[a];Object.keys(u).length>=J&&(u={});if(angular.isString(a)){var l="https://"===a.slice(0,8);if(a&&(-1!==(l?a.slice(8):a).indexOf("//")||"/"===a.charAt(a.length-1)||"/"===a.charAt(0))){try{throw Error("Invalid path interpolation: "+a);}catch(c){if(b)throw c;console.log(c.stack.replace(/\n[^\n]*(altfire|angular(\.min)?)\.js[^\n]*$/gm,""))}return u[a]=
null}if(!l){if(!z)throw Error("Relative path given and default root not specified.");a=u[a]=z+a}}return a}function E(a,b,l,c,k){function r(a){return[x(e?e(a):b,k),x(g?g(a):l,k)]}a.$watch||(k=!0);l&&-1===b.search("#")&&(b+="/#");var e=angular.isString(b)?t(b,!1):void 0,g=angular.isString(l)?t(l,!1):void 0;!k&&a.$watch&&a.$watch(r,function(a){d&&angular.equals(a,d)||(d=null,c.apply(null,a))},!0);var d=r(a);c.apply(null,d)}function n(a,b,l,d,k,r,s){function y(){r&&(I(r),m.allowedKeys={});"viaKeys"===
k||"viaValues"===k?angular.forEach(a[b],function(a,b){C([b],a)}):d&&C([],a[b]);F&&F();v&&v.destroy();delete a[b]}function h(a,b,c){var d=a.toString();A[d]||(A[d]={});A[d][b]||(A[d][b]=[]);A[d][b].push(c);a.on(b,c)}function I(a){var b=A[a.toString()];b&&angular.forEach(b,function(b,d){angular.forEach(b,function(b){a.off(d,b)})});delete A[a.toString()]}function n(){if("via"===k)h(r,"value",function(c){d&&(C([],a[b]),delete a[b]);if(c.hasChildren())throw Error("via value of "+r+" must not be an object, ignoring: "+
c.val());m.filterValue=c.val();d=new Firebase(G.replace("#",m.filterValue));w([],t)});else if("viaKeys"===k||"viaValues"===k)a[b]=a[b]||{},h(r,"value",function(a){m.filterValue=q(a);m.filterValue?angular.forEach(m.filterValue,function(a,b){"$"!==b.charAt(0)&&x("viaKeys"===k?b:s(a),!0)}):u()}),h(r,"child_removed",function(a){x(a.name(),!1)});else if("viaIds"===k)if(a[b]=a[b]||{},m.filterValue=r,r.length)for(var c=0;c<r.length;c++)x(r[c],!0);else u()}function p(a,b){if((m.isReady||angular.isObject(b))&&
!angular.isUndefined(b)){var c=z(a);b=g.fireCopy(b);angular.isObject(b)&&!angular.isArray(b)?c.update(b):c.set(b)}}function x(c,d){if(c&&!!m.allowedKeys[c]!==d)if(d)m.allowedKeys[c]=!0,w([c],E(c));else{var l=a[b]&&a[b][c];B("child_removed",[],c);C([c],l);delete m.allowedKeys[c]}}function t(c){e.$evalAsync(function(){m.isReady?angular.isObject(c)&&angular.isObject(a[b])||(a[b]=c,v&&(v.savedScope[b]=angular.copy(c))):(a[b]=g.fireMerge(c,a[b]),u(),"bind"===l&&m.ready().then(function(){p([],a[b])}))})}
function E(c){return function(d){angular.isObject(d)&&angular.isObject(a[b]&&a[b][c])||angular.isUndefined(a[b])||(a[b][c]=d,v&&(v.savedScope[b][c]=angular.copy(d)),!m.isReady&&Object.keys(m.allowedKeys).every(function(c){return a[b].hasOwnProperty(c)})&&u(),m.isReady&&e.$evalAsync(function(){}))}}function u(){m.isReady||(m.isReady=!0,f(function(){D.resolve()}))}function z(a){var b;G&&"via"!==k?(b=new Firebase(G.replace("#",a[0])),1<a.length&&(b=b.child(a.slice(1).join("/")))):b=a.length?(d.ref?d.ref():
d).child(a.join("/")):d;return b}function w(a,b){a=a||[];var c=z(a);h(c,"child_added",function(b){var c=q(b);b.hasChildren()&&w(a.concat(b.name()));B("child_added",a,b.name(),c)});h(c,"child_removed",function(b){C(a.concat(b.name()),q(b));B("child_removed",a,b.name())});h(c,"child_changed",function(b){b.hasChildren()||B("child_changed",a,b.name(),b.val())});b&&h(c,"value",function(a){b(q(a))})}function C(a,b){a=a||[];var c=z(a);angular.isObject(b)&&angular.forEach(b,function(b,c){angular.isString(c)&&
"$"===c.charAt(0)||C(a.concat(c),b)});I(c)}function B(c,d,l,k){e.$evalAsync(function(){var e=g.parsePath(b,d);switch(c){case "child_removed":g.remove(e(a),l,k);v&&g.remove(e(v.savedScope),l);break;case "child_added":case "child_changed":g.set(e(a),l,k),v&&g.set(e(v.savedScope),l,angular.copy(k))}})}var m={},A={};s=s||angular.identity;var D=c.defer();a.$on&&a.$on("$destroy",y);m.destroy=y;m.isReady=!1;m.ready=function(){return D.promise};if(r){m.allowedKeys={};var G=d;d=null;n();m[k+"Ref"]=r}else w([],
t),m.ref=d;var v,F;"bind"===l&&(v=g.makeObjectReporter(a,b,p),F=e.$watch(v.compare,angular.noop));return m}var h={},z=null,B={},w=null,u={},J=5E3;h.setDefaultConstructorMap=function(a){B=angular.copy(a);w=null};var K=function(){w||(w=[],angular.forEach(B,function(a,b){var c=[],d=x(b,!0).replace(/\b\$[^\/]+/g,function(a){c.push(a);return"([^/]+)"});w.push({constructor:a,variables:c,regex:RegExp("^"+d.replace(/[$-.?[-^{|}]/g,"\\$&")+"$")})}));return w},D=function(a){for(var b=K(),c=0;c<b.length;c++){var d=
b[c];d.regex.lastIndex=0;var e=d.regex.exec(a);if(e){a=new d.constructor;for(b=0;b<d.variables.length;b++)a[d.variables[b]]=e[b+1];return a}}};h.setDefaultRoot=function(a){angular.isString(a)||(a=a.toString());if(0!==a.search(/^https?:\/\//))throw Error("Firebase root URL must start with http(s)://, got: "+a);"/"!==a.charAt(a.length-1)&&(a+="/");d(a,z);z=a;u={};w=null};var H=0;h.getDefaultServerTimestamp=function(){return(new Date).getTime()+H};h.ref=function(a,b){return new Firebase(x(t(b)(a)))};
h.connectOne=function(a){function b(b){a.query&&(b=a.query(b));return b}if(!a.name)throw Error("Must provide a name for the connection.");if(1!==("bind"in a)+("pull"in a)+("once"in a)+("noop"in a))throw Error('Each connection must specify exactly one of "bind", "pull", "once" and "noop".');var d,e;angular.forEach(["bind","pull","once","noop"],function(b){b in a&&(d=b,e=a[b])});var k="ref",g,h;angular.forEach(["via","viaKeys","viaValues","viaIds"],function(b){if(b in a){if(g)throw Error('A connection can specify at most one of "via", "viaKeys", "viaValues", and "viaIds".');
g=b;"viaIds"===b?k=null:(h=a[b],k=b+"Ref")}});if(g&&("once"===d||"noop"===d))throw Error('Cannot combine via* with "once" or "noop".');if(a.viaValueExtractor&&"viaValues"!==g)throw Error('Can only use "viaValueExtractor" with "viaValues".');if("viaIds"===g&&a.query)throw Error("Cannot combine viaIds with a query.");var f;E(a.pathScope||a.scope,e,h,function(e,s){f&&(f.destroy(),f=null);if("noop"===d&&e)f={destroy:angular.noop,isReady:!0,ready:function(){return c.when()}},f[k]=b(new Firebase(e));else if("once"===
d&&e){var y=c.defer(),x=f={destroy:angular.noop,isReady:!1,ready:function(){return y.promise}};f[k]=b(new Firebase(e));f[k].once("value",function(b){f===x&&(a.scope[a.name]=q(b),f.isReady=!0,y.resolve())})}else!e||h&&!s||(f=s?n(a.scope,a.name,d,e,g,b(new Firebase(s)),a.viaValueExtractor):"viaIds"===g?n(a.scope,a.name,d,e,g,a.viaIds):n(a.scope,a.name,d,b(new Firebase(e))))});var s={destroy:function(){f&&f.destroy()},isReady:function(){return f&&f.isReady},ready:function(){return f&&f.ready()},allowedKeys:function(){return f&&
f.allowedKeys}};k&&(s[k]=function(){var a=f[k];a.ref&&(a=a.ref());arguments.length&&(a=a.child(Array.prototype.slice.call(arguments,0).join("/")));return a});g&&(s[g]=function(){return f.filterValue});return s};h.connect=function(a,b){var d={};angular.forEach(b,function(b,c){b.scope=a;b.name=c;d[c]=h.connectOne(b)});d.$allReady=function(){var b=[],e=[];angular.forEach(d,function(a,c){"$"!==c.charAt(0)&&(b.push(c),a.ready()&&e.push(a.ready()))});return c.all(e).then(function(){var c={};angular.forEach(b,
function(b){c[b]=a[b]});return c})};d.$areAllReady=function(){var a=!0;angular.forEach(d,function(b,c){"$"!==c.charAt(0)&&(a=a&&b.isReady())});return a};d.$destroyAll=function(){angular.forEach(d,function(a,b){"$"!==b.charAt(0)&&a.destroy()})};return d};h.toArrayOrderedByKey=function(a){var b=[];a&&(angular.forEach(a,function(a,c){angular.isObject(a)&&(a.$key=c,b.push(a))}),p(b,"$key"));return b};return h}]).factory("fireHelpers",[function(){var t={remove:function(c,f){angular.isArray(c)?c.splice(f,
1):c&&delete c[f]},set:function(c,f,e){c&&(c[f]=e)},parsePath:function(c,f){return function(e){e=e[c];for(var p=0,g=f.length;p<g;p++){if(angular.isUndefined(e))return;e=e[f[p]]}return e}},fireCopy:function(c){if(angular.isObject(c)){var f=angular.isArray(c)?Array(c.length):{},e;for(e in c)c.hasOwnProperty(e)&&("$"!==e.charAt(0)&&angular.isDefined(c[e]))&&(angular.isObject(c[e])?f[e]=t.fireCopy(c[e]):f[e]=c[e]);return f}return c},fireMerge:function(c,f){if(angular.equals(c,f))return f;if(angular.isArray(c)&&
angular.isArray(f))return f.concat(c);if(angular.isObject(c)&&angular.isObject(f)){for(var e in c)f[e]=c[e];return f}return(angular.isUndefined(c)||null===c)&&angular.isDefined(f)?f:c},makeObjectReporter:function(c,f,e){function p(c,d){angular.isUndefined(d)&&(d=null);c.shift();e(c,d)}function g(c,d,e,f,q){if(!e.charAt||"$"!==e.charAt(0)){q--;if(!q&&!angular.equals(c[e],d[e]))return c[e]=angular.copy(d[e]),p(f.concat(e),d[e]);d=d[e];var n=c[e],h;if(angular.isObject(d))if(angular.isArray(d)){angular.isArray(n)||
(p(f.concat(e),d),c[e]=n=d.slice());if(n.length>d.length)for(c=d.length,h=n.length;c<h;c++)p(f.concat(e,c),null);n.length=d.length;c=0;for(h=d.length;c<h;c++)g(n,d,c,f.concat(e),q)}else{if(!angular.isObject(n)||angular.isArray(n))p(f.concat(e),d),c[e]=n=angular.copy(d);for(h in d)d.hasOwnProperty(h)&&g(n,d,h,f.concat(e),q);for(h in n)d.hasOwnProperty(h)||(delete n[h],p(f.concat(e,h),null))}else d!==n&&(c[e]=d,p(f.concat(e),d))}}var q={};q[f]=angular.copy(c[f]);return{savedScope:q,compare:function(){g(q,
c,f,[],6)},destroy:function(){q&&delete q[f];q=null}}}};return t}]);
(function(){function t(c,f){angular.forEach(f,function(f,d){var q=c[d];c[d]=function(){var c=arguments[f]||angular.noop,g=Array.prototype.slice.call(arguments),n=this;g[f]=function(f){var g=c.apply(this,arguments);f&&g!==Firebase.IGNORE_ERROR&&angular.forEach(e,function(c){c(f,n,d)})};return q.apply(this,g)}});return c}function c(e){t(e,{on:2,once:2});angular.forEach(["limit","startAt","endAt"],function(f){var p=e[f];e[f]=function(){return c(p.apply(this,arguments))}});return e}function f(){if(!p){t(Firebase.prototype,
{auth:1,set:1,update:1,setWithPriority:2,setPriority:1,transaction:1});var e=Firebase.prototype.onDisconnect;Firebase.prototype.onDisconnect=function(){return t(e.apply(this,arguments),{set:1,setWithPriority:2,update:1,remove:0,cancel:0})};c(Firebase.prototype);p=!0}}Firebase.IGNORE_ERROR={};var e=[],p=!1;Firebase.onError=function(c){f();e.push(c);return c};Firebase.offError=function(c){c=e.indexOf(c);-1!==c&&e.splice(c,1)}})();}).call(window);
